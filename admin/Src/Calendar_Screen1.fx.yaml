Calendar_Screen1 As screen:
    OnHidden: |-
        =//UpdateContext({Humberger:false})//未使用変数
    OnVisible: |-
        =Set(disp_menu, false);
        // 今月にリセット
        Refresh([@work_db]);
        Reset(YearDropdown1);
        Reset(MonthDropdown1);
        UpdateContext({selected_date: Today()});
        Set(_firstDayOfMonth, DateAdd(Today(), 1 - Day(Today()), TimeUnit.Days));
        Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 2 + 1), TimeUnit.Days));
        Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
        Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
        
        
        UpdateContext({dispChangeRange: false});
        Select(Update2)

    ScreenContainer1_1 As groupContainer.verticalAutoLayoutContainer:
        Fill: =RGBA(250, 250, 250, 1)
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =5
        LayoutJustifyContent: =LayoutJustifyContent.Center
        LayoutMode: =LayoutMode.Auto
        PaddingBottom: =16
        PaddingLeft: =16
        PaddingRight: =16
        PaddingTop: =16
        Width: =Parent.Width
        ZIndex: =1

        TitleBar_5 As TitleBar:
            LayoutMinHeight: =640
            LayoutMinWidth: =640
            TitleBarLabel: ="勤務状況"
            UserName: |-
                =LookUp(user_db,mail_address=User().Email).user_name & "　" & LookUp(user_db,mail_address=User().Email).user_id & "
                " & User().Email
            UserPermissionName: =First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).permission_name
            ZIndex: =1

        TableNameContainer1_6 As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            Fill: =RGBA(0, 120, 212, 1)
            FillPortions: =0
            Height: =50
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutMinHeight: =60
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            Visible: =false
            ZIndex: =2

            BackButton1_4 As icon.ChevronLeft:
                BorderColor: =RGBA(0, 0, 0, 0)
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                DisabledColor: =RGBA(225, 223, 221, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                Fill: =RGBA(0, 120, 212, 1)
                FocusedBorderThickness: =0
                Height: =Parent.Height
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =RGBA(0, 120, 212, 1)
                Icon: =Icon.Hamburger
                OnSelect: |-
                    =//UpdateContext({Humberger:!Humberger})//未使用変数
                PaddingBottom: =15
                PaddingLeft: =15
                PaddingRight: =15
                PaddingTop: =15
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =RGBA(16, 110, 190, 1)
                PressedFill: =RGBA(0, 0, 0, 0)
                Width: =Self.Height
                ZIndex: =1

            TableNameLabel1_6 As label:
                BorderColor: =RGBA(0, 0, 0, 1)
                Color: =RGBA(255, 255, 255, 1)
                DisabledColor: =RGBA(186, 186, 186, 1)
                Fill: =RGBA(0, 120, 212, 1)
                FillPortions: =5
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =68
                PaddingBottom: =16
                PaddingLeft: =16
                PaddingRight: =16
                PaddingTop: =16
                Size: =12
                Text: |-
                    =//DataSourceInfo([@holiday_db], DataSourceInfo.DisplayName)
                    "勤怠カレンダー
                    "&
                    Calendar_UserPicker1.Selected.user_name & "　" & Calendar_UserPicker1.Selected.user_id & "　" & Calendar_UserPicker1.Selected.mail_address
                Visible: |-
                    =// If(MainScreen1.Size = ScreenSize.Small, false, true)
                    true
                Width: =300
                ZIndex: =2

            UserPermissionName As label:
                Align: =Align.Right
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(161, 159, 157, 1)
                FillPortions: =1
                FocusedBorderThickness: =4
                Font: =Font.Lato
                LayoutMinWidth: =100
                Size: =12
                Text: =First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).permission_name
                ZIndex: =3

            UserName1_1 As label:
                Align: =Align.Right
                BorderColor: =RGBA(0, 120, 212, 1)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(161, 159, 157, 1)
                Fill: =RGBA(0, 120, 212, 1)
                FillPortions: =2
                FocusedBorderThickness: =4
                Font: =Font.Lato
                Height: =70
                LayoutMinWidth: =300
                PaddingRight: =20
                Size: =12
                Text: |-
                    =LookUp(user_db,mail_address=User().Email).user_name & "　" & LookUp(user_db,mail_address=User().Email).user_id & "
                    " & User().Email
                Width: =Parent.Width - BackButton1_4.Width - TableNameLabel1_6.Width - UserPermissionName.Width
                X: =283
                Y: =88
                ZIndex: =4

        BodyContainer1_1 As groupContainer.horizontalAutoLayoutContainer:
            DropShadow: =DropShadow.None
            Height: =0
            LayoutGap: =16
            LayoutMinHeight: =0
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =2
            PaddingLeft: =2
            PaddingRight: =2
            PaddingTop: =2
            ZIndex: =3

            SidebarContainer1_1 As groupContainer.verticalAutoLayoutContainer:
                Fill: =RGBA(255, 255, 255, 1)
                FillPortions: =10
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =LayoutDirection.Vertical
                LayoutGap: =10
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingBottom: =10
                PaddingLeft: =10
                PaddingRight: =10
                PaddingTop: =10
                Visible: |
                    =If(And(Calendar_Screen1.Size = ScreenSize.Small, Or(newMode, editMode, itemSelected)), false, true)
                ZIndex: =1

                Calendar_SearchContainer1 As groupContainer.horizontalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    Fill: =RGBA(245, 245, 245, 1)
                    FillPortions: =0
                    Height: =44
                    LayoutMinHeight: =100
                    LayoutMinWidth: =0
                    LayoutMode: =LayoutMode.Auto
                    ZIndex: =1

                    Calendar_SearchIcon1 As icon:
                        BorderColor: =RGBA(0, 0, 0, 1)
                        Color: =RGBA(0, 69, 120, 1)
                        DisabledBorderColor: =RGBA(56, 56, 56, 1)
                        DisabledColor: =RGBA(119, 119, 119, 1)
                        Height: =44
                        Icon: =Icon.Reset
                        OnSelect: |-
                            =Reset(Calendar_UseridInput1);
                            Reset(Calendar_UserPicker1)
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        Tooltip: ="名前の検索をやめる"
                        Width: =44
                        ZIndex: =1

                    Calendar_UserPicker1 As combobox:
                        BorderColor: =RGBA(245, 245, 245, 1)
                        ChevronBackground: =RGBA(245, 245, 245, 1)
                        ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                        ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                        ChevronFill: =RGBA(50, 49, 48, 1)
                        ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                        ChevronHoverFill: =RGBA(50, 49, 48, 1)
                        Color: =RGBA(50, 49, 48, 1)
                        DefaultSelectedItems: |-
                            =// LookUp([@user_db], mail_address = User().Email)
                            If(
                                !IsBlank(Calendar_UseridInput1.Text),
                                LookUp([@user_db], user_id = Value(Calendar_UseridInput1.Text)),
                                LookUp([@user_db], mail_address = User().Email)
                            )
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        DisabledFill: =RGBA(242, 242, 241, 0)
                        DisplayFields: =["Title","user_id"]
                        DisplayMode: |-
                            =If(
                                First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin && admin_app,
                                Parent.DisplayMode,
                                DisplayMode.Disabled // 管理者以外は無効化
                            )
                        Fill: =RGBA(245, 245, 245, 1)
                        FillPortions: =1
                        Font: =Font.'Segoe UI'
                        Height: =44
                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                        HoverColor: =RGBA(50, 49, 48, 1)
                        HoverFill: =RGBA(245, 245, 245, 1)
                        InputTextPlaceholder: ="ユーザー名"
                        Items: |
                            =With(
                                {
                                    is_admin: First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin,
                                    sorted_user_db: Sort(Filter([@user_db], StartsWith(user_name, Self.SearchText),visible), user_id, SortOrder.Ascending),
                                    only_me: Filter([@user_db], mail_address = User().Email)
                                },
                                If(
                                    is_admin,
                                    sorted_user_db,
                                    only_me
                                )
                            )
                        LayoutMinWidth: =100
                        OnChange: =Select(Update2)
                        OnSelect: =Reset(Calendar_UseridInput1)
                        PaddingBottom: =0
                        PaddingLeft: =12
                        PaddingTop: =0
                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                        PressedFill: =RGBA(0, 120, 212, 1)
                        SearchFields: =["Title"]
                        SearchItems: |-
                            =Search(With({is_admin:First(Filter([@permission_db],permission_type=First(Filter([@user_db],mail_address=User().Email)).permission_type)).admin,sorted_user_db:Sort(Filter([@user_db],StartsWith(user_name,Self.SearchText),visible),user_id,SortOrder.Ascending),only_me:Filter([@user_db],mail_address=User().Email)},If(is_admin,sorted_user_db,only_me)),Calendar_UserPicker1.SearchText,Title)
                        SelectionFill: =RGBA(0, 120, 212, 1)
                        SelectMultiple: =false
                        Template: =ListItemTemplate.Double
                        Width: =Parent.Width - Calendar_SearchIcon1.Width - 2
                        ZIndex: =3

                    Calendar_UseridInput1 As text:
                        BorderThickness: =0
                        Default: =
                        DelayOutput: =true
                        DisplayMode: |-
                            =If(
                                First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin && admin_app,
                                Parent.DisplayMode,
                                DisplayMode.Disabled // 管理者以外は無効化
                            )
                        Fill: =RGBA(245, 245, 245, 1)
                        FillPortions: =1
                        Format: =TextFormat.Number
                        Height: =44
                        HintText: =If(admin_app, "職員番号", "")
                        LayoutMinWidth: =100
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        ZIndex: =4

                RecordsListSeparator1_1 As rectangle:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledFill: =RGBA(230, 230, 230, 1)
                    Fill: =RGBA(230, 230, 230, 1)
                    FocusedBorderThickness: =4
                    Height: =1
                    HoverFill: =RGBA(230, 230, 230, 1)
                    LayoutMinWidth: =200
                    PressedFill: =RGBA(230, 230, 230, 1)
                    ZIndex: =3

                CalendarContainer1 As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    DropShadow: =DropShadow.None
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    ZIndex: =4

                    DatePickerContainer1_1 As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =44
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =1

                        Editable As groupContainer.manualLayoutContainer:
                            DropShadow: =DropShadow.None
                            LayoutMinHeight: =Parent.Height
                            LayoutMinWidth: =Parent.Height
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Visible: |-
                                =// ロックまたはデータなしは非表示
                                If(Lock.Visible || NoData.Visible, false, true)
                            ZIndex: =1

                            EditableText1 As label:
                                Align: =Align.Center
                                Color: =RGBA(99, 139, 44, 1)
                                Font: =Font.Lato
                                Height: =10
                                LineHeight: =1
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: ="編集可能"
                                Width: =Parent.Width
                                Y: =Parent.Height - Self.Height
                                ZIndex: =1

                            EditableIcon1 As icon.Lock:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(99, 139, 44, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =4
                                Height: =Parent.Height
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Edit
                                PaddingBottom: =17
                                PaddingLeft: =7
                                PaddingRight: =7
                                PaddingTop: =7
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                Width: =Parent.Width
                                ZIndex: =2

                        NoData As groupContainer.manualLayoutContainer:
                            DropShadow: =DropShadow.None
                            LayoutMinHeight: =Parent.Height
                            LayoutMinWidth: =Parent.Height
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Visible: =IsBlankOrError(LookUp([@monthly_db], user_id = Calendar_UserPicker1.Selected.user_id && year_month_date = Date(YearDropdown1.Selected.Value,MonthDropdown1.Selected.Value,1)))
                            ZIndex: =2

                            EditableText1_1 As label:
                                Align: =Align.Center
                                Color: =RGBA(118, 0, 0, 1)
                                Font: =Font.Lato
                                Height: =10
                                LineHeight: =1
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: ="表示不可"
                                Width: =Parent.Width
                                Y: =Parent.Height - Self.Height
                                ZIndex: =1

                            EditableIcon1_1 As icon.Lock:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(118, 0, 0, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =4
                                Height: =Parent.Height
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.GlobeNotConnected
                                PaddingBottom: =17
                                PaddingLeft: =7
                                PaddingRight: =7
                                PaddingTop: =7
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                Width: =Parent.Width
                                ZIndex: =2

                        Lock As groupContainer.manualLayoutContainer:
                            DropShadow: =DropShadow.None
                            LayoutMinHeight: =Parent.Height
                            LayoutMinWidth: =Parent.Height
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Visible: |-
                                =With(
                                    {
                                        monthly_db: LookUp([@monthly_db], user_id = Calendar_UserPicker1.Selected.user_id && year_month_date = Date(YearDropdown1.Selected.Value,MonthDropdown1.Selected.Value,1))
                                    },
                                    monthly_db.lock || monthly_db.submit_date <> Blank() // 月末ロック済 または 月末申請済
                                )
                            ZIndex: =3

                            LockText1 As label:
                                Align: =Align.Center
                                Color: =RGBA(118, 0, 0, 1)
                                Font: =Font.Lato
                                Height: =10
                                LineHeight: =1
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: ="編集不可"
                                Width: =Parent.Width
                                Y: =Parent.Height - Self.Height
                                ZIndex: =1

                            LockIcon1 As icon.Lock:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(118, 0, 0, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =4
                                Height: =Parent.Height
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Lock
                                PaddingBottom: =17
                                PaddingLeft: =7
                                PaddingRight: =7
                                PaddingTop: =7
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                Tooltip: ="月末申請が提出済みまたは編集ロック"
                                Width: =Parent.Width
                                ZIndex: =2

                        iconPrevMonth1 As icon.ChevronLeft:
                            AlignInContainer: =AlignInContainer.Start
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Color: =RGBA(0, 69, 120, 1)
                            DisabledBorderColor: =RGBA(245, 245, 245, 1)
                            DisabledColor: =RGBA(225, 223, 221, 1)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FillPortions: =2
                            FocusedBorderColor: =
                            FocusedBorderThickness: =0
                            Height: =Parent.Height
                            HoverBorderColor: =
                            HoverColor: =
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Icon: =Icon.ChevronLeft
                            OnSelect: |-
                                =// 先月
                                Refresh([@work_db]);
                                Set(_firstDayOfMonth, DateAdd(_firstDayOfMonth, -1, TimeUnit.Months));
                                Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 1), TimeUnit.Days));
                                Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
                                Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
                                // ドロップダウン更新
                                Reset([@YearDropdown1]);
                                Reset([@MonthDropdown1]);
                                
                                Select(Update2);
                            PaddingBottom: =7
                            PaddingLeft: =7
                            PaddingRight: =7
                            PaddingTop: =7
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(16, 110, 190, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            TabIndex: =0
                            Tooltip: ="前月を表示"
                            Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, false, true)
                            Width: =59
                            Y: =
                            ZIndex: =4

                        YearDropdown1 As dropdown:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            ChevronBackground: =RGBA(245, 245, 245, 1)
                            ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                            ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                            ChevronFill: =RGBA(50, 49, 48, 1)
                            ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                            ChevronHoverFill: =RGBA(50, 49, 48, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Year(_firstDayOfMonth)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(242, 242, 241, 0)
                            Fill: =RGBA(245, 245, 245, 1)
                            FillPortions: =4
                            Font: =Font.'Segoe UI'
                            Height: =44
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(245, 245, 245, 1)
                            Items: =Sequence(5,Year(Today())-3)
                            LayoutMinWidth: =10
                            OnChange: |-
                                =// ドロップボックスの年月に更新
                                Refresh([@work_db]);
                                Set(_firstDayOfMonth, Date(YearDropdown1.Selected.Value, MonthDropdown1.Selected.Value, 1));
                                Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 1), TimeUnit.Days));
                                Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
                                Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
                                
                                Select(Update2);
                            OnSelect: =
                            PaddingBottom: =5
                            PaddingLeft: =12
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            SelectionColor: =RGBA(50, 49, 48, 1)
                            SelectionFill: =RGBA(0, 0, 0, 0)
                            Width: =Parent.Width/2
                            Y: =3
                            ZIndex: =5

                        YearText1 As label:
                            AlignInContainer: =AlignInContainer.Start
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FillPortions: =1
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =Parent.Height
                            LayoutMinWidth: =10
                            Text: ="年"
                            Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, false, true)
                            ZIndex: =6

                        MonthDropdown1 As dropdown:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            ChevronBackground: =RGBA(245, 245, 245, 1)
                            ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                            ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                            ChevronFill: =RGBA(50, 49, 48, 1)
                            ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                            ChevronHoverFill: =RGBA(50, 49, 48, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            Default: =Month(_firstDayOfMonth)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(242, 242, 241, 0)
                            Fill: =RGBA(245, 245, 245, 1)
                            FillPortions: =4
                            Font: =Font.'Segoe UI'
                            Height: =44
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(50, 49, 48, 1)
                            HoverFill: =RGBA(245, 245, 245, 1)
                            Items: =["1","2","3","4","5","6","7","8","9","10","11","12"]
                            LayoutMinWidth: =10
                            OnChange: |-
                                =// ドロップボックスの年月に更新
                                Refresh([@work_db]);
                                Set(_firstDayOfMonth, Date(YearDropdown1.Selected.Value, MonthDropdown1.Selected.Value, 1));
                                Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 1), TimeUnit.Days));
                                Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
                                Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
                                
                                Select(Update2);
                            OnSelect: =
                            PaddingBottom: =5
                            PaddingLeft: =12
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            SelectionColor: =RGBA(50, 49, 48, 1)
                            SelectionFill: =RGBA(0, 0, 0, 0)
                            Width: =Parent.Width/2
                            Y: =3
                            ZIndex: =7

                        MonthText1 As label:
                            AlignInContainer: =AlignInContainer.Start
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FillPortions: =1
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =Parent.Height
                            LayoutMinWidth: =10
                            Text: ="月"
                            Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, false, true)
                            ZIndex: =8

                        iconNextMonth1 As icon.ChevronRight:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Color: =RGBA(0, 69, 120, 1)
                            DisabledBorderColor: =RGBA(245, 245, 245, 1)
                            DisabledColor: =RGBA(225, 223, 221, 1)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FillPortions: =2
                            FocusedBorderColor: =
                            FocusedBorderThickness: =0
                            Height: =Parent.Height
                            HoverBorderColor: =
                            HoverColor: =
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Icon: =Icon.ChevronRight
                            OnSelect: |-
                                =// 来月
                                Refresh([@work_db]);
                                Set(_firstDayOfMonth, DateAdd(_firstDayOfMonth, 1, TimeUnit.Months));
                                Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 1), TimeUnit.Days));
                                Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
                                Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
                                ClearCollect(MyCalendarEvents, Filter([@work_db], user_id = Calendar_UserPicker1.Selected.user_id, Start >= _firstDayInView, Start < _lastDayInView));
                                // ドロップダウン更新
                                Reset([@YearDropdown1]);
                                Reset([@MonthDropdown1]);
                                
                                Select(Update2);
                            PaddingBottom: =7
                            PaddingLeft: =7
                            PaddingRight: =7
                            PaddingTop: =7
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(16, 110, 190, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            TabIndex: =0
                            Tooltip: ="翌月を表示"
                            Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, false, true)
                            Width: =59
                            X: =419 - Self.Width
                            Y: =
                            ZIndex: =9

                        CalendarHelpButton As icon.Help:
                            Height: =Parent.Height
                            Icon: =Icon.Help
                            PaddingBottom: =5
                            PaddingLeft: =5
                            PaddingRight: =5
                            PaddingTop: =5
                            ZIndex: =10

                        TodayButtonContainer As groupContainer.manualLayoutContainer:
                            DropShadow: =DropShadow.None
                            LayoutMinHeight: =Parent.Height
                            LayoutMinWidth: =60
                            ZIndex: =11

                            TodayButtonText As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.Lato
                                FontWeight: =FontWeight.Semibold
                                Height: =Parent.Height
                                HoverColor: =ColorFade(Self.Color, 20%)
                                OnSelect: =Select(TodayButton)
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =4
                                Size: =8
                                Text: ="今日"
                                Width: =Parent.Width
                                ZIndex: =1

                            TodayButton As icon:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(56, 56, 56, 1)
                                DisabledColor: =RGBA(119, 119, 119, 1)
                                Height: =Parent.Height
                                Icon: =Icon.CalendarBlank
                                OnSelect: |-
                                    =// 今月にリセット
                                    Refresh([@work_db]);
                                    Reset(YearDropdown1);
                                    Reset(MonthDropdown1);
                                    UpdateContext({selected_date: Today()});
                                    Set(_firstDayOfMonth, DateAdd(Today(), 1 - Day(Today()), TimeUnit.Days));
                                    Set(_firstDayInView, DateAdd(_firstDayOfMonth, -(Weekday(_firstDayOfMonth, StartOfWeek.Monday) - 1), TimeUnit.Days));
                                    Set(_lastDayOfMonth, DateAdd(DateAdd(_firstDayOfMonth, 1, TimeUnit.Months), 0, TimeUnit.Days));
                                    Set(_lastDayInView, DateAdd(_lastDayOfMonth, (Weekday(_lastDayOfMonth, StartOfWeek.Monday) + 7), TimeUnit.Days));
                                    Select(Update2)
                                PaddingBottom: =5
                                PaddingLeft: =5
                                PaddingRight: =5
                                PaddingTop: =5
                                Tooltip: ="名前の検索をやめる"
                                Width: =Parent.Width
                                ZIndex: =2

                    WeekdayGallery1 As gallery.WeekdayGallery:
                        '#CopilotOverlayLabel': ="フィルター済み"
                        AccessibleLabel: ="曜日"
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(245, 245, 245, 1)
                        FillPortions: =0
                        Height: =25
                        Items: =["月", "火", "水", "木", "金", "土", "日"]
                        LayoutMinHeight: =0
                        LayoutMinWidth: =100
                        ShowScrollbar: =false
                        TemplatePadding: =0
                        TemplateSize: =MonthDayGallery1.Width / 7
                        Width: =420
                        Y: =
                        ZIndex: =2

                        WeekdayText1 As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 1)
                            Color: =If(And(Calendar_Screen1.Size = ScreenSize.Small, !newMode, !editMode, !itemSelected), Color.White, RGBA(50, 49, 48, 1))
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisplayMode: =DisplayMode.View
                            Font: =Font.Arial
                            Height: =WeekdayGallery1.TemplateHeight
                            LineHeight: =0
                            OnSelect: =Select(Parent)
                            PaddingBottom: =0
                            PaddingLeft: =3
                            PaddingRight: =0
                            PaddingTop: =3
                            Size: =12
                            Text: =ThisItem.Value
                            Width: =WeekdayGallery1.TemplateWidth
                            Wrap: =false
                            X: =WeekdayGallery1.TemplateWidth / 2 - Self.Width / 2
                            Y: =WeekdayGallery1.TemplateHeight / 2 - Self.Height / 2
                            ZIndex: =1

                    MonthDayGallery1 As gallery.MonthDayGallery:
                        '#CopilotOverlayLabel': ="フィルター済み"
                        AccessibleLabel: ="選択した月の日数"
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderColor: =RGBA(230, 230, 230, 1)
                        DelayItemLoading: =true
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =
                        Items: =[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19, 20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]
                        Layout: =Layout.Vertical
                        LayoutMinHeight: =0
                        LayoutMinWidth: =0
                        LoadingSpinner: =LoadingSpinner.Data
                        ShowScrollbar: =false
                        TemplatePadding: =0
                        TemplateSize: =Self.Height / 6
                        Width: =420
                        WrapCount: =If(Calendar_Screen1.Size = ScreenSize.Small, 1, 7)
                        Y: =
                        ZIndex: =3

                        SelectedDayFill As rectangle:
                            BorderStyle: =BorderStyle.None
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            Fill: |
                                =// 選択した日付は水色
                                If(
                                    DateAdd(_firstDayInView, ThisItem.Value) = selected_date,
                                    ColorFade(TodayCircle.Fill, 0.85),
                                    Left(WorkTime.Text,3) = "要確認",
                                    Color.LightYellow,
                                    Left(WorkTime.Text,4) = "出勤確認",
                                    Color.LightPink,
                                    Color.White
                                )
                            FocusedBorderThickness: =4
                            Height: =Parent.TemplateHeight
                            HoverFill: =RGBA(0, 0, 0, 0)
                            OnSelect: =Select(Parent)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Visible: |-
                                =/*This item is in a row containing no days of the visible month. It is in the row after the row where the last day of the month occurs*/ 
                                //!(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) - Weekday(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)) + 1 > _lastDayOfMonth)
                                true
                            Width: =Parent.TemplateWidth
                            X: =Parent.X
                            Y: =Parent.X
                            ZIndex: =1

                        MenkyuLabel As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(255, 255, 255, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(109, 49, 162, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Bold
                            Height: =22
                            OnSelect: =Select(Parent)
                            Size: =8
                            Text: ="免休"
                            Visible: |
                                =// 職務免除(労働なし)
                                With(
                                    {
                                        this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                    },
                                    !IsEmpty(
                                        Filter(
                                            current_month_holiday_db,
                                            LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "職務免除(労働なし)",
                                            Date(Year(start_date),Month(start_date),Day(start_date)) <= this_date,
                                            Date(Year(end_date),Month(end_date),Day(end_date))  >= this_date,
                                            !(is_check = false && !IsBlank(check_id))//却下ではない
                                        )
                                    )
                                )
                            Width: =40
                            X: =Parent.TemplateWidth-Self.Width-5
                            Y: =5
                            ZIndex: =3

                        MenrouLabel As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(255, 255, 255, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(246, 88, 16, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Bold
                            Height: =22
                            OnSelect: =Select(Parent)
                            Size: =8
                            Text: ="免労"
                            Visible: |
                                =// 職務免除(労働あり)
                                With(
                                    {
                                        this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                    },
                                    !IsEmpty(
                                        Filter(
                                            current_month_holiday_db,
                                            LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "職務免除(労働あり)",
                                            Date(Year(start_date),Month(start_date),Day(start_date)) <= this_date,
                                            Date(Year(end_date),Month(end_date),Day(end_date))  >= this_date,
                                            !(is_check = false && !IsBlank(check_id))//却下ではない
                                        )
                                    )
                                )
                            Width: =40
                            X: =Parent.TemplateWidth-Self.Width-5
                            Y: =5
                            ZIndex: =5

                        WorkTime As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.Arial
                            Height: =87
                            OnSelect: =Select(Parent)
                            PaddingTop: =30
                            Size: =10
                            Text: |-
                                =// 勤務場所, 勤務時間
                                With(
                                    {
                                        date_record: Filter(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days) ||  DateValue(Text(End)) = DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days)),
                                        this_item_date: DateAdd(_firstDayInView, ThisItem.Value)
                                    },
                                    // 休暇申請重複チェック
                                    With(
                                        {
                                            this_date: DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days)
                                        },
                                        If(
                                            !IsEmpty(
                                                Filter(
                                                    current_month_holiday_db,
                                                    start_date <= this_date,
                                                    end_date   >= this_date,
                                                    !(is_check = false && !IsBlank(check_id)),//却下ではない
                                                    LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "休暇願い"
                                                )
                                            ) && CountRows(date_record) > 0,
                                            "要確認
                                休暇申請重複",
                                            // 複数出勤レコードあり
                                            If(
                                                CountRows(date_record) > 1,
                                                With(
                                                    {
                                                        overlapping_exists:
                                                            !IsEmpty(
                                                                Filter(
                                                                    date_record As record1,
                                                                    !IsEmpty(
                                                                        Filter(
                                                                            date_record As record2,
                                                                            record1.ID <> record2.ID &&
                                                                            (
                                                                                (record1.Start <= record2.End && record1.End >= record2.Start) ||
                                                                                (record2.Start <= record1.End && record2.End >= record1.Start)
                                                                            )
                                                                        )
                                                                    )
                                                                )
                                                            ),
                                                        // 勤務場所
                                                        work_place: First(Filter(date_record,type.Value in ["学内","在宅"])).type.Value,
                                                        // 勤務時間
                                                        is_minus: Sum(date_record, work_time) < 0,
                                                        work_time: RoundUp(Sum(date_record, work_time) / 60, 1),
                                                        //update 2024/10/10 土肥
                                                        //時間を加算するレコード数
                                                        count_hour_record: CountRows(Filter(date_record,type.Value in ["学内","在宅"])),
                                                        // 出勤時間, 退勤時間
                                                        start_time1: Text(First(Filter(date_record,type.Value in ["学内","在宅"])).Start, "hh:mm"),
                                                        end_time1: Text(First(Filter(date_record,type.Value in ["学内","在宅"])).End, "hh:mm"),
                                                        start_time2: Text(Last(Filter(date_record,type.Value in ["学内","在宅"])).Start, "hh:mm"),
                                                        end_time2: Text(Last(Filter(date_record,type.Value in ["学内","在宅"])).End, "hh:mm"),
                                                        is_null: If(CountRows(Filter(date_record, IsBlankOrError(Start) || IsBlankOrError(End))) > 0, true, false),
                                                        work_place2:First(Filter(date_record,Not(type.Value in ["学内","在宅"]))).type.Value
                                                    },
                                                    If(
                                                        overlapping_exists,
                                                        "要確認
                                勤務時間重複",
                                                        If(
                                                            is_null || is_minus,
                                                            "要確認
                                勤務時間確認",  
                                
                                
                                                        //update 2024/10/10 土肥
                                                        // 複数レコード出勤 エラーなし
                                                        //勤務場所に出張or  職免がないかつ「学内」、「在宅」レコードが2つ以上
                                                        If(IsBlank(work_place2) && (count_hour_record > 1),
                                                            $"{work_place} {work_time} h
                                {start_time1}~{end_time1}
                                {start_time2}~{end_time2}
                                    ",
                                    //勤務場所に出張or  職免がないかつ「学内」、「在宅」レコードが1つ
                                    IsBlank(work_place2),
                                    $"{work_place} {work_time} h
                                    {start_time1}~{end_time1}",
                                
                                    //勤務場所に出張，職免のいずれかがあり、もう一つが学内か在宅である場合
                                    work_place in ["学内","在宅"],$"{work_place2}
                                {work_place} {work_time} h　{start_time1}~{end_time1}"
                                                        
                                                        )
                                                    )
                                                    )
                                                ),
                                                // 単一出勤レコードあり
                                                If(
                                                    CountRows(date_record) > 0,
                                                    With(
                                                        {
                                                            // 勤務場所
                                                            work_place: First(date_record).type.Value,
                                                            // 勤務時間
                                                            is_minus: Sum(date_record, work_time) < 0,
                                                            work_time: RoundUp(Sum(date_record, work_time) / 60, 1),
                                                            // 出勤時間, 退勤時間
                                                            start_time: Text(First(date_record).Start, "hh:mm"),
                                                            end_time: Text(First(date_record).End, "hh:mm"),
                                                            is_null: If(IsBlankOrError(First(date_record).Start) || IsBlankOrError(First(date_record).End), true, false)
                                                        },
                                                        If(
                                                            is_null || is_minus && work_place <> "職免",
                                                            "要確認
                                勤務時間確認",          
                                                        //学内以外は勤務場所のみ表示
                                                        If(Not(work_place in ["学内","在宅"]),
                                                        $"{work_place}",
                                                        // 単一レコード出勤エラーなし
                                                        $"{work_place} {work_time} h
                                {start_time}~{end_time}")
                                                        )
                                                    ),
                                                    // 出勤レコード抜け
                                                    With(
                                                        {
                                                            // 今月
                                                            is_this_month: this_item_date >= _firstDayOfMonth && this_item_date < _lastDayOfMonth,
                                                            // 過ぎた日
                                                            is_passed_day: this_item_date < Today(),
                                                            // 休日ではない
                                                            isnot_holiday: !HolidayCircle.Visible,
                                                            // 休暇申請した日ではない
                                                            isnot_appday: !hanko_circle_7.Visible,
                                                            //職免申請した日ではない
                                                            isnot_exepday: !MenkyuLabel.Visible
                                                            /*IsEmpty(
                                                                Filter(
                                                                    current_month_holiday_db,
                                                                    start_date <= this_date,
                                                                    end_date   >= this_date,
                                                                    !(is_check = false && !IsBlank(check_id))//却下ではない
                                                                )
                                                            )*/
                                                        },
                                                        // 出勤レコード抜け判定条件式
                                                        is_this_month && is_passed_day && isnot_holiday && isnot_appday && isnot_exepday
                                                    ),
                                                    "出勤確認
                                データなし"
                                                )
                                            )
                                        )
                                    )
                                )
                                
                                /*
                                With(
                                    {
                                        date_record: Filter(MyCalendarEvents, date = DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days)),
                                        this_item_date: DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days)
                                    },
                                        With(
                                        {
                                            // 今月
                                            is_this_month: this_item_date >= _firstDayOfMonth && this_item_date < _lastDayOfMonth,
                                            // 過ぎた日
                                            is_passed_day: this_item_date < Today(),
                                            // 休日ではない
                                            isnot_holiday: !HolidayCircle.Visible,
                                            // 休暇申請した日ではない
                                            isnot_appday:
                                            IsEmpty(
                                                Filter(
                                                    current_month_holiday_db,
                                                    start_date <= this_item_date,
                                                    end_date   >= this_item_date,
                                                    !(is_check = false && !IsBlank(check_id))//却下ではない
                                                )
                                            ),
                                            // 欠勤レコード
                                            is_absenceday: First(date_record).is_absence,
                                            // 勤務場所
                                            work_place: First(Filter(date_record,type.Value = "学内")).type.Value,
                                            // 勤務時間
                                            is_minus: Sum(date_record, work_time) < 0,
                                            work_time: RoundUp(Sum(date_record, work_time) / 60, 1),
                                            // 出勤時間, 退勤時間
                                            start_time: Text(First(Filter(date_record,type.Value = "学内")).Start, "hh:mm"),
                                            end_time: Text(Last(Filter(date_record,type.Value = "学内")).End, "hh:mm"),
                                            is_null: If(CountRows(Filter(date_record, IsBlankOrError(Start) || IsBlankOrError(End))) > 0, true, false),
                                            work_place2:First(Filter(date_record,type.Value <> "学内")).type.Value
                                        },
                                        If(
                                
                                            is_this_month && is_passed_day && isnot_holiday && isnot_appday && is_absenceday,
                                            "欠勤
                                データなし",
                                            true in date_record.duplicate_application,
                                            "要確認
                                休暇申請重複",
                                            true in date_record.error_work_time,
                                            "要確認
                                勤務時間抜け",
                                            IsBlank(Filter(date_record, work_time >= 0)),
                                            "要確認
                                勤務時間不正",
                                            true in date_record.overlapping_exists,
                                            "要確認
                                勤務時間重複",
                                            $"{work_place} {work_time} h
                                        {start_time}~{end_time}"
                                            )
                                        )
                                )
                                
                                */
                            VerticalAlign: =VerticalAlign.Top
                            Visible: |-
                                =/*This item is in a row containing no days of the visible month. It is in the row after the row where the last day of the month occurs*/ 
                                 !(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) - Weekday(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)) + 1 > _lastDayInView)
                            Width: =Parent.TemplateWidth
                            X: =Parent.X
                            ZIndex: =10

                        IsWorkDay2 As circle:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            Fill: |
                                =With(
                                    {
                                        reg_type: First(LastN(Filter(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) || DateValue(Text(End)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)),2)).reg_type.Value
                                    },
                                    If(
                                        reg_type = "カードリーダー",
                                            RGBA(246, 88, 16, 1),
                                        reg_type = "カードリーダー編集",
                                            RGBA(60,179,113,1),
                                        reg_type = "教員",
                                            RGBA(147,112,219,1),
                                        RGBA(0, 0, 0, 1)
                                    )
                                )
                            Height: =6.5
                            OnSelect: =Select(Parent)
                            Visible: |
                                =// 予定が2つ
                                CountRows(Filter(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) || DateValue(Text(End)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days))) > 1
                            Width: =6.5
                            X: =IsWorkDay.X + 10
                            Y: =IsWorkDay.Y
                            ZIndex: =11

                        IsWorkDay As circle:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            Fill: |
                                =With(
                                    {
                                        reg_type: First(LastN(Filter(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) || DateValue(Text(End)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)),1)).reg_type.Value
                                    },
                                    If(
                                        reg_type = "カードリーダー",
                                            RGBA(246, 88, 16, 1),
                                        reg_type = "カードリーダー編集",
                                            RGBA(60,179,113,1),
                                        reg_type = "教員",
                                            RGBA(147,112,219,1),
                                        RGBA(0, 0, 0, 1)
                                    )
                                )
                            Height: =6.5
                            OnSelect: =Select(Parent)
                            Visible: |
                                =/*Visible if calendar events are found on this day*/               
                                CountRows(Filter(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) || DateValue(Text(End)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days))) > 0
                            Width: =6.5
                            X: =MonthDayGallery1.TemplateWidth * (0.35)
                            Y: =MonthDayGallery1.TemplateHeight * (0.1)
                            ZIndex: =12

                        HolidayCircle As circle:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            DisabledFill: =RGBA(0, 120, 212, 1)
                            Fill: =Color.LightGray
                            Height: =24
                            HoverFill: =RGBA(0, 120, 212, 1)
                            OnSelect: =Select(Parent)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Visible: |
                                =With(
                                    {
                                        date_record: LookUp([@public_holiday_db], date = DateAdd(_firstDayInView, ThisItem.Value)),
                                        holiday_weekday: ForAll(LookUp([@user_db], user_id = Calendar_UserPicker1.Selected.user_id).holiday_weekday, Value(ThisRecord.Value))
                                    },
                                    If(Abs(DateTitle.Text - ThisItem.Value) > 10,
                                        false,
                                        If(IsBlankOrError(date_record),
                                            // public_holiday_dbの指定なし→土日判定
                                            If(Weekday(DateAdd(_firstDayInView, ThisItem.Value)) in holiday_weekday,
                                                true,// 休日
                                                false
                                            ),
                                            If(date_record.is_holiday,
                                                true,// 休日
                                                false
                                            )
                                        )
                                    )
                                )
                            Width: =Self.Height
                            X: =Parent.X + 5
                            Y: =Parent.X + 2
                            ZIndex: =13

                        TodayCircle As circle:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            DisabledFill: =RGBA(0, 120, 212, 1)
                            Height: =24
                            HoverFill: =RGBA(0, 120, 212, 1)
                            OnSelect: =Select(Parent)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Visible: =DateAdd(_firstDayInView, ThisItem.Value) = Today()
                            Width: =Self.Height
                            X: =Parent.X + 5
                            Y: =Parent.X + 2
                            ZIndex: =14

                        DateTitle As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(237, 237, 237, 1)
                            Color: |-
                                =// 今日の日付→白
                                // 今月外→グレー
                                // それ以外→黒
                                If(DateAdd(_firstDayInView, ThisItem.Value) = Today(), RGBA(255,255,255,1),  Abs(Self.Text - ThisItem.Value) > 10,RGBA(200, 200, 200, 0.5), Color.Black)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(0,0,0,0)
                            FocusedBorderColor: =RGBA(128, 128, 128, 1)
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =MonthDayGallery1.TemplateHeight
                            OnSelect: =
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =14
                            TabIndex: =0
                            Text: =Day(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days))
                            VerticalAlign: =VerticalAlign.Top
                            Visible: |-
                                =/*This item is in a row containing no days of the visible month. It is in the row after the row where the last day of the month occurs*/ 
                                true
                                // !(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days) - Weekday(DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)) + 1 > _lastDayOfMonth)
                            Width: =35
                            Wrap: =false
                            X: =Parent.X
                            Y: =Parent.X
                            ZIndex: =15

                        HolidayRequestLabelSmall As group:
                            Height: =5
                            Width: =5
                            X: =40
                            Y: =38
                            ZIndex: =15

                            hanko_circle_7 As circle:
                                BorderColor: =RGBA(184, 0, 0, 1)
                                BorderThickness: =2
                                DisabledFill: |
                                    =
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =20
                                HoverFill: =
                                PressedFill: =
                                Tooltip: ="休暇申請日"
                                Visible: |
                                    =// 休暇申請
                                    With(
                                        {
                                            this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                        },
                                        !IsEmpty(
                                            Filter(
                                                current_month_holiday_db,
                                                LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "休暇願い",
                                                Date(Year(start_date),Month(start_date),Day(start_date)) <= this_date,
                                                Date(Year(end_date),Month(end_date),Day(end_date))  >= this_date,
                                                !(is_check = false && !IsBlank(check_id))//却下ではない
                                            )
                                        )
                                    )
                                Width: =20
                                X: =Parent.TemplateWidth-Self.Width-2
                                Y: =Parent.X + 2
                                ZIndex: =6

                            hanko_label_7 As label:
                                Align: =Align.Center
                                Color: =RGBA(184, 0, 0, 1)
                                Font: =Font.Arial
                                FontWeight: =FontWeight.Bold
                                Height: =20
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =10
                                Text: ="休"
                                Tooltip: ="休暇申請日"
                                Visible: |
                                    =// 休暇申請
                                    With(
                                        {
                                            this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                        },
                                        !IsEmpty(
                                            Filter(
                                                current_month_holiday_db,
                                                LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "休暇願い",
                                                Date(Year(start_date),Month(start_date),Day(start_date)) <= this_date,
                                                Date(Year(end_date),Month(end_date),Day(end_date))  >= this_date,
                                                !(is_check = false && !IsBlank(check_id))//却下ではない
                                            )
                                        )
                                    )
                                Width: =20
                                X: =Parent.TemplateWidth-Self.Width-2
                                Y: =Parent.X + 2
                                ZIndex: =7

                        HolidayWorkLabelSmall As group:
                            Height: =5
                            Width: =5
                            X: =40
                            Y: =40
                            ZIndex: =15

                            hanko_circle_1 As circle:
                                BorderColor: =RGBA(255, 255, 255, 1)
                                DisabledFill: =RGBA(0, 134, 208, 1)
                                DisplayMode: |-
                                    =If(
                                        LookUp(
                                            MyCalendarEvents,
                                            DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)).is_holiday_work,
                                        If(
                                            IsBlankOrError(
                                                LookUp(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)).id_substitute_holiday),
                                            DisplayMode.View, // 未振替
                                            DisplayMode.Disabled), // 振替済み
                                        false // 通常出勤
                                    )
                                Fill: =RGBA(168, 0, 0, 1)
                                Height: =30
                                HoverFill: =
                                PressedFill: =
                                Tooltip: ="休日出勤(未振替)"
                                Visible: |-
                                    =// 休日出勤
                                    With(
                                        {
                                            this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                        },
                                        If(
                                            LookUp(
                                                MyCalendarEvents,
                                                DateValue(Text(Start)) = this_date).is_holiday_work,
                                            If(
                                                IsBlankOrError(
                                                    LookUp(MyCalendarEvents, DateValue(Text(Start)) = this_date).id_substitute_holiday),
                                                true, // 未振替
                                                true), // 振替済み
                                            false // 通常出勤
                                        )
                                    )
                                Width: =30
                                X: =Parent.TemplateWidth-Self.Width-2
                                Y: =Parent.X + 2
                                ZIndex: =8

                            hanko_label_1 As label:
                                Align: =Align.Center
                                Color: =RGBA(255, 255, 255, 1)
                                DisabledColor: =RGBA(255, 255, 255, 1)
                                DisplayMode: |-
                                    =If(
                                        LookUp(
                                            MyCalendarEvents,
                                            DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)).is_holiday_work,
                                        If(
                                            IsBlankOrError(
                                                LookUp(MyCalendarEvents, DateValue(Text(Start)) = DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)).id_substitute_holiday),
                                            DisplayMode.View, // 未振替
                                            DisplayMode.Disabled), // 振替済み
                                        false // 通常出勤
                                    )
                                Font: =Font.Arial
                                FontWeight: =FontWeight.Bold
                                Height: =30
                                LineHeight: =1
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: |-
                                    ="休日
                                    出勤"
                                Tooltip: ="休日出勤(未振替)"
                                Visible: |-
                                    =// 休日出勤
                                    With(
                                        {
                                            this_date: DateAdd(_firstDayInView,ThisItem.Value, TimeUnit.Days)
                                        },
                                        If(
                                            LookUp(
                                                MyCalendarEvents,
                                                DateValue(Text(Start)) = this_date).is_holiday_work,
                                            If(
                                                IsBlankOrError(
                                                    LookUp(MyCalendarEvents, DateValue(Text(Start)) = this_date).id_substitute_holiday),
                                                true, // 未振替
                                                true), // 振替済み
                                            false // 通常出勤
                                        )
                                    )
                                Width: =30
                                X: =Parent.TemplateWidth-Self.Width-2
                                Y: =Parent.X + 2
                                ZIndex: =9

                        ClickPanel As rectangle:
                            BorderColor: =RGBA(230, 230, 230, 1)
                            BorderThickness: =1
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            DisplayMode: =If(Abs(DateTitle.Text - ThisItem.Value) > 10, DisplayMode.Disabled, DisplayMode.Edit)
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderThickness: =4
                            Height: =MonthDayGallery1.TemplateHeight
                            HoverFill: =RGBA(0, 0, 0, 0)
                            OnSelect: |-
                                =UpdateContext({itemSelected: true, selected_date: DateAdd(_firstDayInView, ThisItem.Value, TimeUnit.Days)});
                                //Select(Update1);
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Width: =MonthDayGallery1.TemplateWidth
                            X: =Parent.X
                            Y: =Parent.X
                            ZIndex: =16

            RightContainer1_1 As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.None
                FillPortions: =7
                Height: =Parent.Height
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =LayoutDirection.Vertical
                LayoutGap: =10
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingBottom: =2
                PaddingLeft: =2
                PaddingRight: =2
                Visible: =If(Or(deleteMode, dispMenu,RegisterBusinessTripMode, And(Calendar_Screen1.Size = ScreenSize.Small, !newMode, !editMode, !itemSelected)), false, true)
                Width: =0
                ZIndex: =2

                DayRecordSelectContainer As groupContainer.verticalAutoLayoutContainer:
                    Fill: =RGBA(255, 255, 255, 1)
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =10
                    LayoutMinHeight: =230
                    LayoutMinWidth: =200
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =10
                    PaddingRight: =10
                    ZIndex: =1

                    DayTitleContainer As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =35
                        LayoutGap: =4
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =1

                        MenuTitleText2 As label:
                            AlignInContainer: =AlignInContainer.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(255, 255, 255, 1)
                            FillPortions: =3
                            FocusedBorderThickness: =4
                            Font: =Font.Lato
                            Height: =35
                            LayoutMinWidth: =0
                            PaddingBottom: =0
                            PaddingLeft: =10
                            PaddingRight: =0
                            PaddingTop: =10
                            Size: =18
                            Text: |-
                                ="今月の勤務状況"
                                // Text(_dateSelected, "yyyy年 m月 d日 ddd", "ja-JP")
                            Width: =Parent.Width
                            ZIndex: =1

                        MenuIcon As icon:
                            AlignInContainer: =AlignInContainer.Start
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Color: =RGBA(0, 120, 212, 1)
                            DisabledBorderColor: =RGBA(245, 245, 245, 1)
                            DisabledColor: =RGBA(225, 223, 221, 1)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FocusedBorderThickness: =4
                            Height: =44
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(16, 110, 190, 1)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Icon: =Icon.Hamburger
                            OnSelect: |-
                                =If(dispMenu, UpdateContext({ dispMenu: false }), UpdateContext({ dispMenu: true }))
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(16, 110, 190, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Visible: =false
                            Width: =44
                            ZIndex: =3

                        RegisterBusinessTripMenuButton As button:
                            AlignInContainer: =AlignInContainer.Center
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =0
                            Fill: =RGBA(128, 128, 128, 1)
                            Height: =30
                            HoverBorderColor: =RGBA(0, 120, 212, 1)
                            HoverFill: =RGBA(113, 111, 110, 1)
                            OnSelect: |-
                                =If(RegisterBusinessTripMode,UpdateContext({RegisterBusinessTripMode:false}),UpdateContext({RegisterBusinessTripMode:true}))
                            PressedBorderColor: =RGBA(0, 69, 120, 1)
                            PressedColor: =RGBA(255, 255, 255, 1)
                            PressedFill: =RGBA(113, 111, 110, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =13
                            Text: ="一括登録"
                            Visible: |-
                                =First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin && admin_app
                                //false
                            Width: =150
                            ZIndex: =4

                        MenuButton1 As button:
                            AlignInContainer: =AlignInContainer.Center
                            BorderColor: =RGBA(0, 120, 212, 1)
                            BorderStyle: =BorderStyle.None
                            DisabledBorderColor: =RGBA(0, 120, 212, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(242, 242, 241, 0)
                            Fill: =RGBA(128, 128, 128, 1)
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =RGBA(0, 120, 212, 1)
                            HoverFill: =RGBA(113, 111, 110, 1)
                            OnSelect: |-
                                =If(dispMenu, UpdateContext({ dispMenu: false }), UpdateContext({ dispMenu: true }))
                            PressedBorderColor: =RGBA(0, 69, 120, 1)
                            PressedColor: =RGBA(255, 255, 255, 1)
                            PressedFill: =RGBA(113, 111, 110, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =13
                            Text: ="休日出勤一覧"
                            Width: =150
                            ZIndex: =5

                    RecordsListSeparator1_4 As rectangle:
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        Fill: =RGBA(230, 230, 230, 1)
                        FocusedBorderThickness: =4
                        Height: =1
                        HoverFill: =RGBA(230, 230, 230, 1)
                        LayoutMinWidth: =200
                        PressedFill: =RGBA(230, 230, 230, 1)
                        ZIndex: =2

                    DateInfoContainer As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =60
                        LayoutMinHeight: =50
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        ZIndex: =3

                        DateInfoText As label:
                            AlignInContainer: =AlignInContainer.Stretch
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(255, 255, 255, 1)
                            FillPortions: =1
                            FocusedBorderThickness: =4
                            Font: =Font.Lato
                            Height: =50
                            LayoutMinWidth: =200
                            LineHeight: =1
                            PaddingBottom: =0
                            PaddingLeft: =10
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =12
                            Text: |
                                =// 各種情報を表示
                                With(
                                    {
                                        a: LookUp([@user_db], user_id = Calendar_UserPicker1_1.Selected.user_id).holiday_weekday,
                                        monthly_record: LookUp([@monthly_db], user_id = Calendar_UserPicker1.Selected.user_id && year_month_date = Date(YearDropdown1.Selected.Value, MonthDropdown1.Selected.Value, 1)),
                                        // work_days: CountRows(Distinct(Filter(MyCalendarEvents, Start >= _firstDayOfMonth, Start < _lastDayOfMonth), date)),
                                        // confirmed_work_days: CountRows(Distinct(Filter(MyCalendarEvents, Start >= _firstDayOfMonth, Start < _lastDayOfMonth, reg_type.Value="カードリーダー" || reg_type.Value="カードリーダー編集"), date)),
                                        // work_time: Sum(Filter(MyCalendarEvents, Start >= _firstDayOfMonth, Start < _lastDayOfMonth), work_time),
                                        holiday_record:
                                        LookUp(
                                            current_month_holiday_db,
                                            start_date <= selected_date &&
                                            end_date   >= selected_date &&
                                            !(is_check = false && !IsBlank(check_id))//却下ではない
                                        )
                                    },
                                    If(!IsBlank(holiday_record),
                                $"{LookUp(RenameColumns([@apply_type_db],type_id,TypeID),holiday_record.type_id = TypeID).major_type.Value} {LookUp(RenameColumns([@apply_type_db],type_id,TypeID),holiday_record.type_id = TypeID).type_name}",
                                $"勤務 {monthly_record.work_days} 日 ({RoundUp(monthly_record.work_time/60, 1)} 時間)
                                出勤 {monthly_record.confirmed_work_days} 日
                                "
                                    )
                                )
                            Width: =Parent.Width
                            ZIndex: =2

                    RecordsListSeparator1_5 As rectangle:
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        Fill: =RGBA(230, 230, 230, 1)
                        FocusedBorderThickness: =4
                        Height: =1
                        HoverFill: =RGBA(230, 230, 230, 1)
                        LayoutMinWidth: =200
                        PressedFill: =RGBA(230, 230, 230, 1)
                        ZIndex: =4

                    "RecordsGallery1_2 As gallery.'BrowseLayout_Vertical_ThreeTextVariant_ver5.0'":
                        '#CopilotOverlayLabel': ="フィルター済み"
                        BorderColor: =RGBA(245, 245, 245, 1)
                        Default: =//First(SortByColumns(Filter([@work_db], user_id = UserPicker1.Selected.user_id, Start >= _dateSelected, Start < DateAdd(_dateSelected, 1, TimeUnit.Days)), "Start"))
                        DelayItemLoading: =true
                        Fill: =RGBA(255, 255, 255, 1)
                        Items: =Filter(MyCalendarEvents, DateValue(Text(Start)) = selected_date || DateValue(Text(End)) = selected_date)
                        Layout: =Layout.Vertical
                        LayoutMinHeight: =80
                        LayoutMinWidth: =320
                        LoadingSpinner: =LoadingSpinner.Data
                        OnSelect: |-
                            =UpdateContext({ selectedRecord: RecordsGallery1_2.Selected, editMode: false });
                        TemplatePadding: =0
                        TemplateSize: =80
                        WrapCount: |
                            =If(Calendar_Screen1.Size = ScreenSize.Small, 1, 2)
                        ZIndex: =5

                        Rectangle1_3 As rectangle:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            DisabledFill: =If(ThisItem.IsSelected, ColorFade(TodayCircle.Fill, 0.85), RGBA(0,0,0,0))
                            Fill: =If(ThisItem.IsSelected, ColorFade(TodayCircle.Fill, 0.85), RGBA(0,0,0,0))
                            FocusedBorderThickness: =4
                            Height: =RecordsGallery1_2.TemplateHeight
                            HoverFill: =If(ThisItem.IsSelected, ColorFade(TodayCircle.Fill, 0.85), RGBA(0,0,0,0))
                            OnSelect: =Select(Parent)
                            PressedFill: =If(ThisItem.IsSelected, ColorFade(TodayCircle.Fill, 0.85), RGBA(0,0,0,0))
                            Width: =RecordsGallery1_2.TemplateWidth
                            ZIndex: =1

                        Separator5_1 As rectangle:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Fill: =RGBA(255, 255, 255, 1)
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Width: =0
                            X: =312
                            ZIndex: =2

                        Separator5_2 As rectangle:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Fill: =RGBA(255, 255, 255, 1)
                            Height: =8
                            OnSelect: =Select(Parent)
                            Width: =Parent.TemplateWidth
                            Y: =Parent.TemplateHeight - Self.Height
                            ZIndex: =3

                        RecordGalleryWorkTime As label:
                            BorderColor: =RGBA(0, 0, 0, 1)
                            Color: =RGBA(96, 94, 92, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Font: =Font.'Segoe UI'
                            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                            Height: =Self.Size * 1.8
                            OnSelect: =Select(Parent)
                            PaddingBottom: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =10
                            Text: =ThisItem.reg_type.Value
                            VerticalAlign: =VerticalAlign.Top
                            Width: =RecordGalleryType.Width
                            X: =RecordGalleryType.X
                            Y: =RecordGalleryType.Y + RecordGalleryType.Height + RecordGalleryRegType.Height
                            ZIndex: =4

                        RecordGalleryRegType As label:
                            BorderColor: =RGBA(0, 0, 0, 1)
                            Color: =RGBA(96, 94, 92, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Font: =Font.'Segoe UI'
                            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                            Height: =22
                            OnSelect: =Select(Parent)
                            PaddingBottom: =3
                            PaddingRight: =0
                            PaddingTop: =3
                            Size: =12
                            Text: =If(Not(ThisItem.type.Value in  ["学内","在宅"]),"",TimeValue(ThisItem.Start) & "~" & TimeValue(ThisItem.End) & " 休憩 " & ThisItem.break_time & " 分")
                            VerticalAlign: =VerticalAlign.Top
                            Width: =RecordGalleryType.Width+5
                            X: =RecordGalleryType.X
                            Y: =25
                            ZIndex: =5

                        RecordGalleryType As label:
                            BorderColor: =RGBA(0, 0, 0, 1)
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Font: =Font.'Segoe UI'
                            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                            Height: =Self.Size * 1.5
                            OnSelect: =Select(Parent)
                            PaddingBottom: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =14
                            Text: |-
                                =If(ThisItem.type.Value <> "学内",
                                    $"{ThisItem.type.Value}",
                                    $"{ThisItem.type.Value} {
                                    RoundUp(DateDiff(
                                        DateAdd(
                                            ThisItem.Start,
                                            ThisItem.break_time,
                                            TimeUnit.Minutes
                                        ),
                                        ThisItem.End,
                                        TimeUnit.Minutes
                                    )/60,1)
                                } h")
                            VerticalAlign: =VerticalAlign.Top
                            Width: =Parent.TemplateWidth - 86
                            X: =16
                            Y: =(Parent.TemplateHeight - (Self.Size*1.8 + RecordGalleryRegType.Size*1.8 + 2 + RecordGalleryWorkTime.Size*1.8)) / 2
                            ZIndex: =6

                        NextArrow3 As icon.ChevronRight:
                            AccessibleLabel: =Self.Tooltip
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Color: =RGBA(166, 166, 166, 1)
                            DisabledBorderColor: =RGBA(245, 245, 245, 1)
                            DisabledColor: =RGBA(225, 223, 221, 1)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FocusedBorderThickness: =4
                            Height: =50
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(16, 110, 190, 1)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Icon: =Icon.ChevronDown
                            OnSelect: =Select(Parent)
                            PaddingBottom: =16
                            PaddingLeft: =16
                            PaddingRight: =16
                            PaddingTop: =16
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(16, 110, 190, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Tooltip: ="項目の詳細の表示"
                            Width: =50
                            X: =Parent.TemplateWidth - Self.Width - 12
                            Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2) - 4
                            ZIndex: =7

                        Rectangle3 As rectangle:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Fill: |-
                                =If(
                                    ThisItem.reg_type.Value = "カードリーダー",
                                        RGBA(246, 88, 16, 1),
                                    ThisItem.reg_type.Value = "カードリーダー編集",
                                        RGBA(60,179,113,1),
                                    ThisItem.reg_type.Value = "教員",
                                        RGBA(147,112,219,1),
                                    RGBA(0, 0, 0, 1) // 管理者
                                )
                                /*
                                If(
                                    ThisItem.type.Value = "学内",
                                        RGBA(246, 88, 16, 1),
                                    ThisItem.type.Value = "出張",
                                        RGBA(147,112,219,1),
                                    ThisItem.type.Value = "休日",
                                        RGBA(60,179,113,1),
                                    RGBA(0, 0, 0, 1)
                                )*/
                            Height: =Parent.TemplateHeight - Separator5_2.Height
                            OnSelect: =Select(Parent)
                            Width: =4
                            ZIndex: =8

                MainContainer1_1 As groupContainer.verticalAutoLayoutContainer:
                    Fill: =RGBA(255, 255, 255, 1)
                    FillPortions: =4
                    Height: =Parent.Height/2
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    Visible: =!dispMenu
                    ZIndex: =3

                    Container1 As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =10
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingLeft: =10
                        PaddingRight: =10
                        ZIndex: =1

                        SelectedRecordHeaderContainer1_1 As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            Fill: =RGBA(255, 255, 255, 1)
                            FillPortions: =0
                            Height: =35
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            Width: =Parent.Width
                            ZIndex: =1

                            BackIconButton1_1 As icon.Add:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 120, 212, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.ChevronLeft
                                OnSelect: |-
                                    =UpdateContext({ itemSelected: false })
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                TabIndex: =0
                                Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, And(!editMode, !newMode, !deleteMode), false)
                                Width: =44
                                ZIndex: =1

                            SelectedRecordTitle1_1 As label:
                                AlignInContainer: =AlignInContainer.Start
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                FillPortions: =1
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                Height: =35
                                LayoutMinWidth: =250
                                PaddingBottom: =0
                                PaddingLeft: =20
                                PaddingRight: =0
                                PaddingTop: =10
                                Size: =14
                                Text: |-
                                    =//RecordsGallery1.Selected.タイトル
                                    //"勤怠情報"
                                    With(
                                        {date_text: Text(selected_date, "yyyy年 m月 d日 ddd", "ja-JP")},
                                        If(newMode, $"{date_text} (新規)",editMode, $"{date_text} (編集)", $"{date_text}")
                                    )
                                Visible: =If(Calendar_Screen1.Size = ScreenSize.Small, false, true)
                                Width: =250
                                ZIndex: =2

                            HolidayDisp As label:
                                Align: =Align.Center
                                AlignInContainer: =AlignInContainer.End
                                AutoHeight: =true
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                Fill: =Color.LightGray
                                FillPortions: =1
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                Height: =30
                                LayoutMinHeight: =30
                                LineHeight: =1
                                PaddingLeft: =0
                                PaddingRight: =0
                                Size: =12
                                Text: |-
                                    =If(IsBlankOrError(LookUp([@public_holiday_db], date = selected_date)),
                                        // public_holiday_dbの指定なし→土日判定
                                        If(Weekday(selected_date) = 1 || Weekday(selected_date) = 7,
                                            "休業日",
                                            ""
                                        ),
                                        LookUp([@public_holiday_db], date = selected_date).title
                                    )
                                VerticalAlign: =VerticalAlign.Bottom
                                Visible: |-
                                    =If(IsBlankOrError(LookUp([@public_holiday_db], date = selected_date)),
                                        // public_holiday_dbの指定なし→土日判定
                                        If(Weekday(selected_date) = 1 || Weekday(selected_date) = 7,
                                            true,// 土日
                                            false// 平日
                                        ),
                                        true
                                    )
                                Width: =200
                                X: =SelectedRecordTitle1_1.Width
                                ZIndex: =3

                            SubmitFormButton1_1 As icon:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =If(Editable.Visible, DisplayMode.Edit, DisplayMode.Disabled)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Check
                                OnSelect: |+
                                    =If(
                                        // 出勤時間<退勤時間
                                        Start_DataCard1.Update > End_DataCard1.Update,
                                        Notify("出勤時刻は退勤時刻よりも前に設定してください", NotificationType.Error),
                                        // 編集ロック
                                        LookUp(monthly_db,
                                        And(user_id = Calendar_UserPicker1.Selected.user_id,//職員番号が等しい
                                            year_month_date >=Date(Year(selected_date),Month(selected_date),1),
                                            year_month_date < DateAdd(Date(Year(selected_date),Month(selected_date),1),1,TimeUnit.Months))).lock,
                                        Notify("提出が締め切られました。編集機能がロックされています。",NotificationType.Error),
                                        
                                        //　とりあえずコメントアウトしています
                                        /*
                                        // 30時間以前の勤怠情報のみ追加可能
                                        DateDiff(Date(Year(Start_DataCard1.Update), Month(Start_DataCard1.Update), Day(Start_DataCard1.Update)), Now(), TimeUnit.Hours) < 30,
                                         Notify("先の勤怠情報を登録することはできません。",NotificationType.Error),
                                         */
                                    
                                        // 休日出勤はメモ必須
                                        is_holiday_work_DataCard3.Update && IsBlank(Subject_DataCard1.Update),
                                        Notify("休日出勤の場合はメモが必須です。",NotificationType.Error),
                                    
                                        /*
                                        // 処理
                                        UpdateContext({target_monthly_item:
                                        First(
                                                Filter(monthly_db
                                                ,user_id = Calendar_UserPicker1.Selected.user_id
                                                ,year_month_date>=Date(Year(Start_DataCard1.Update),Month(Start_DataCard1.Update),1)
                                                , year_month_date < Date(Year(Start_DataCard1.Update), Month(Start_DataCard1.Update) + 1, 1)
                                                )
                                        )
                                        }
                                        );
                                    
                                        //もしかしたら必要なくなるかも
                                        //monthly_dbにパッチを当てる処理（新規申請時）
                                        //該当月の勤務日数と勤務時間を抜き出す
                                        If(newMode,
                                            UpdateContext({now_work_days:target_monthly_item.work_days});
                                            UpdateContext({now_work_hours:target_monthly_item.work_hours});
                                    
                                            UpdateContext({submit_work_start:Start_DataCard1.Update});
                                            UpdateContext({submit_work_end:End_DataCard1.Update}); 
                                            //既に同日のレコードが存在する場合は，日数を増やさない．もし存在しない場合は日数を増やす
                                            If(CountRows(Filter(MyCalendarEvents,DateValue(Text(Start)) = DateValue(Text(Start_DataCard1.Update))))>0,
                                                UpdateContext({new_work_days:now_work_days}),
                                                UpdateContext({new_work_days:now_work_days+1}));
                                                
                                            UpdateContext({new_work_hours:now_work_hours+((DateDiff(submit_work_start,submit_work_end,TimeUnit.Minutes)-Value(DataCardValue2_1.Text))/60)});
                                    
                                            //monthly_dbの該当月のレコードを更新
                                            Patch(monthly_db,target_monthly_item,{work_days:new_work_days});
                                            Patch(monthly_db,target_monthly_item,{work_hours:new_work_hours});
                                            
                                        );
                                        //monthly_dbにパッチを当てる処理（編集時）
                                        
                                        If(editMode,
                                            UpdateContext({now_work_days:target_monthly_item.work_days});
                                            UpdateContext({now_work_hours:target_monthly_item.work_hours});
                                    
                                            UpdateContext({submit_work_start:Start_DataCard1.Update});
                                            UpdateContext({submit_work_end:End_DataCard1.Update}); 
                                            UpdateContext({submit_work_hours:(DateDiff(submit_work_start,submit_work_end,TimeUnit.Minutes)-Value(DataCardValue2_1.Text))/60});
                                            UpdateContext({pre_submit_work_hours:(DateDiff(selectedRecord.Start,selectedRecord.End,TimeUnit.Minutes)-Value(selectedRecord.break_time))/60});
                                    
                                            UpdateContext({new_work_hours:now_work_hours+(submit_work_hours-pre_submit_work_hours)});
                                    
                                            //monthly_dbの該当月のレコードを更新
                                            Patch(monthly_db,target_monthly_item,{work_hours:new_work_hours});
                                        );
                                        */
                                        SubmitForm(WorkTimeForm1);
                                        Notify("申請が完了しました！", NotificationType.Success);
                                        // カレンダーをリロード
                                        // Refresh([@work_db]);
                                        Select(Update2)
                                    )
                                    
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                TabIndex: =0
                                Visible: =Or(editMode, newMode)
                                Width: =44
                                ZIndex: =4

                            ResetFormButton1_1 As icon:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =If(Editable.Visible, DisplayMode.Edit, DisplayMode.Disabled)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Cancel
                                OnSelect: |-
                                    =ResetForm(WorkTimeForm1); UpdateContext({ editMode: false, newMode: false });
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                TabIndex: =0
                                Visible: =Or(editMode, newMode)
                                Width: =44
                                ZIndex: =5

                            EditIconButton1_1 As icon:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =If(Editable.Visible, DisplayMode.Edit, DisplayMode.Disabled)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Edit
                                OnSelect: |-
                                    =UpdateContext({ selectedRecord: RecordsGallery1_2.Selected, editMode: true });
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                TabIndex: =0
                                Visible: =And(!editMode, !newMode, !deleteMode,!IsBlank(RecordsGallery1_2.Selected))
                                Width: =44
                                ZIndex: =6

                            DeleteIconButton1_1 As icon:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =If(Editable.Visible, DisplayMode.Edit, DisplayMode.Disabled)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Trash
                                OnSelect: |-
                                    =UpdateContext({ deleteMode: true, 
                                    //deleteCancelled: false,//未使用変数
                                     selectedRecord: RecordsGallery1_2.Selected });
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                TabIndex: =0
                                Visible: =And(!editMode, !newMode, !deleteMode,!IsBlank(RecordsGallery1_2.Selected))
                                Width: =44
                                X: =NewRecordAddIcon1_1.X-Self.Width
                                ZIndex: =7

                            NewRecordAddIcon1_1 As icon:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(0, 69, 120, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                DisplayMode: =If(And(Editable.Visible,!Or(HolidayCircle.Visible,hanko_label_7.Visible)) , DisplayMode.Edit, DisplayMode.Disabled)
                                FocusedBorderThickness: =4
                                Height: =44
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.Add
                                OnSelect: |-
                                    =NewForm(WorkTimeForm1); UpdateContext({ newMode: true });
                                PaddingBottom: =10
                                PaddingLeft: =10
                                PaddingRight: =10
                                PaddingTop: =10
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                Visible: =And(!newMode,!editMode)
                                Width: =44
                                X: =Parent.Width-Self.Width
                                ZIndex: =8

                        RecordsListSeparator1_8 As rectangle:
                            AlignInContainer: =AlignInContainer.Stretch
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            DisabledFill: =RGBA(230, 230, 230, 1)
                            Fill: =RGBA(230, 230, 230, 1)
                            FocusedBorderThickness: =4
                            Height: =1
                            HoverFill: =RGBA(230, 230, 230, 1)
                            LayoutMinWidth: =200
                            PressedFill: =RGBA(230, 230, 230, 1)
                            ZIndex: =2

                        WorkTimeForm1 As form:
                            BorderColor: =RGBA(245, 245, 245, 1)
                            DataSource: =work_db
                            DefaultMode: =If(newMode, FormMode.New, editMode, FormMode.Edit, FormMode.View)
                            Item: =LookUp([@work_db], ID = RecordsGallery1_2.Selected.ID)
                            LayoutMinHeight: =250
                            LayoutMinWidth: =400
                            NumberOfColumns: =2
                            OnFailure: =Notify("保存できません。フォームにエラーがないか確認してください。", NotificationType.Error)
                            OnSuccess: |-
                                =UpdateContext({ 
                                 //CurrentItem: Self.LastSubmit,//未使用変数
                                 editMode: false, newMode: false })
                            Visible: =Or(!IsBlank(RecordsGallery1_2.Selected),newMode)
                            ZIndex: =3

                            reg_type_DataCard1 As typedDataCard.comboBoxEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="reg_type"
                                Default: |-
                                    =//ThisItem.reg_type
                                    // 管理者の場合は種別を管理者にする
                                    If(
                                        WorkTimeForm1.Mode <> FormMode.View && LookUp([@permission_db], permission_type = LookUp([@user_db], mail_address = User().Email).permission_type).admin && admin_app,
                                        First(Choices([@work_db].reg_type, "管理者")),
                                        // カードリーダーを編集した場合はカードリーダー編集
                                        WorkTimeForm1.Mode = FormMode.Edit && ThisItem.reg_type.Value = "カードリーダー",
                                        First(Choices([@work_db].reg_type, "カードリーダー編集")),
                                        // その他編集
                                        WorkTimeForm1.Mode = FormMode.New,
                                        First(Choices([@work_db].reg_type, "教員")),
                                        ThisItem.reg_type // その他の場合はデフォルト値
                                    )
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"reg_type")
                                    "登録種別"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =false
                                Update: =DataCardValue14_1.Selected
                                Width: =258
                                X: =0
                                Y: =0
                                ZIndex: =1

                                DataCardKey14_1 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue14_1 As combobox:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DefaultSelectedItems: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayFields: =["Value"]
                                    DisplayMode: |-
                                        =DisplayMode.Disabled
                                        /*
                                        If(
                                            First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin,
                                            Parent.DisplayMode,
                                            DisplayMode.Disabled // 管理者以外は無効化
                                        )
                                        */
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =Choices([@work_db].reg_type)
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SearchFields: =["Value"]
                                    SearchItems: =Choices(work_db.reg_type,DataCardValue14_1.SearchText)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    SelectMultiple: =false
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey14_1.Y + DataCardKey14_1.Height + 5
                                    ZIndex: =2

                                ErrorMessage14 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue14_1.Y + DataCardValue14_1.Height
                                    ZIndex: =3

                                StarVisible14 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey14_1.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey14_1.Y
                                    ZIndex: =4

                            type_DataCard1_2 As typedDataCard.comboBoxEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="Location"
                                Default: |-
                                    =//ThisItem.type
                                    // Form1がNewModeの場合は、学内に設定
                                    If(WorkTimeForm1.Mode = 1, First(Choices([@work_db].type, "学内")), ThisItem.type)
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"Location")
                                    "勤務場所"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =true
                                Update: =DataCardValue1_2.Selected
                                Width: =258
                                X: =1
                                Y: =0
                                ZIndex: =1

                                DataCardKey1_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue1_2 As combobox:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DefaultSelectedItems: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayFields: =["Value"]
                                    DisplayMode: |-
                                        =If(
                                            First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin,
                                            Parent.DisplayMode,
                                            DisplayMode.Disabled // 管理者以外は無効化
                                        )
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =Filter(Choices([@work_db].type),Value<>"職免")
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SearchFields: =["Value"]
                                    SearchItems: =Search(Filter(Choices([@work_db].type),Value<>"職免"),DataCardValue1_2.SearchText,Value)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    SelectMultiple: =false
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey1_2.Y + DataCardKey1_2.Height + 5
                                    ZIndex: =2

                                ErrorMessage1_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue1_2.Y + DataCardValue1_2.Height
                                    ZIndex: =3

                                StarVisible1_2 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey1_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey1_2.Y
                                    ZIndex: =4

                            Start_DataCard1 As typedDataCard.dateTimeEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="Start"
                                Default: |-
                                    =//ThisItem.Start
                                    // Form1がNewModeの場合は、8:00に設定
                                    If(WorkTimeForm1.Mode = 1 && DataCardValue1_2.Selected.Value = "学内" , DateTimeValue(Text(Date(Year(selected_date), Month(selected_date), Day(selected_date))) & " " & Text(Time(08, 00, 00))),
                                        DataCardValue1_2.Selected.Value <> "学内", Text(Time(00, 00, 00)) ,ThisItem.Start)
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"Start")
                                    "出勤時刻"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =false
                                Update: =DateTimeValue(Text(Date(Year(selected_date), Month(selected_date), Day(selected_date)))) + Time(Value(HourValue1.Selected.Value), Value(MinuteValue1.Selected.Value), 0)
                                Visible: =If(Not(DataCardValue1_2.Selected.Value in ["学内","在宅"]),false,true)
                                Width: =258
                                X: =0
                                Y: =1
                                ZIndex: =1

                                DataCardKey2_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DateValue1 As datepicker:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    CalendarHeaderFill: =RGBA(16, 110, 190, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DefaultDate: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    EndYear: =Year(Today())+100
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverDateFill: =RGBA(184, 187, 184, 1)
                                    IconBackground: =RGBA(0, 120, 212, 1)
                                    IsEditable: =true
                                    PaddingBottom: =0
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    SelectedDateFill: =RGBA(0, 120, 212, 1)
                                    Size: =13
                                    StartYear: =1899
                                    Tooltip: =Parent.DisplayName
                                    Visible: =false
                                    Width: =(Parent.Width - 60) / 2
                                    X: =30
                                    Y: =DataCardKey2_2.Y + DataCardKey2_2.Height + 5
                                    ZIndex: =2

                                HourValue1 As dropdown:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =If(IsBlankOrError(Parent.Default), "99", Text(Hour(Parent.Default),"00"))
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Fill: =If(IsBlankOrError(Parent.Default), Color.LightPink, RGBA(245, 245, 245, 1))
                                    Font: =Font.'Segoe UI'
                                    Height: =DateValue1.Height
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]
                                    PaddingBottom: =5
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SelectionColor: =RGBA(50, 49, 48, 1)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    Tooltip: =Parent.DisplayName
                                    Width: |-
                                        =//DateValue1.Width / 2 - 10
                                        70
                                    X: |-
                                        =//DateValue1.X + DateValue1.Width + 10
                                        30
                                    Y: =DateValue1.Y
                                    ZIndex: =3

                                Separator1_2 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =HourValue1.Height
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: |-
                                        =":"
                                    Width: =10
                                    Wrap: =false
                                    X: =HourValue1.X + HourValue1.Width
                                    Y: =HourValue1.Y
                                    ZIndex: =4

                                MinuteValue1 As dropdown:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Text(Minute(Parent.Default),"00")
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Fill: =If(IsBlankOrError(Parent.Default), Color.LightPink, RGBA(245, 245, 245, 1))
                                    Font: =Font.'Segoe UI'
                                    Height: =HourValue1.Height
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"]
                                    PaddingBottom: =5
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SelectionColor: =RGBA(50, 49, 48, 1)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    Tooltip: =Parent.DisplayName
                                    Width: =HourValue1.Width
                                    X: =HourValue1.X + HourValue1.Width + Separator1_2.Width
                                    Y: =HourValue1.Y
                                    ZIndex: =5

                                ErrorMessage2_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =HourValue1.Y + HourValue1.Height
                                    ZIndex: =6

                                StarVisible2_2 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey2_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey2_2.Y
                                    ZIndex: =7

                            End_DataCard1 As typedDataCard.dateTimeEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="End"
                                Default: |-
                                    =//ThisItem.End
                                    // Form1がNewModeの場合は、17:00に設定
                                    If(WorkTimeForm1.Mode = 1 && DataCardValue1_2.Selected.Value = "学内", DateTimeValue(Text(Date(Year(selected_date), Month(selected_date), Day(selected_date))) & " " & Text(Time(17, 00, 00))), 
                                        DataCardValue1_2.Selected.Value <> "学内", Text(Time(00, 00, 00)),ThisItem.End)
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"End")
                                    "退勤時刻"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =false
                                Update: =DateTimeValue(Text(Date(Year(selected_date), Month(selected_date), Day(selected_date)))) + Time(Value(HourValue2.Selected.Value), Value(MinuteValue2.Selected.Value), 0)
                                Visible: =If(Not(DataCardValue1_2.Selected.Value in ["学内","在宅"]),false,true)
                                Width: =258
                                WidthFit: =false
                                X: =1
                                Y: =1
                                ZIndex: =1

                                DataCardKey3_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DateValue2 As datepicker:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    CalendarHeaderFill: =RGBA(16, 110, 190, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DefaultDate: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    EndYear: =Year(Today())+100
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverDateFill: =RGBA(184, 187, 184, 1)
                                    IconBackground: =RGBA(0, 120, 212, 1)
                                    IsEditable: =true
                                    PaddingBottom: =0
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    SelectedDateFill: =RGBA(0, 120, 212, 1)
                                    Size: =13
                                    StartYear: =1899
                                    Tooltip: =Parent.DisplayName
                                    Visible: =false
                                    Width: =(Parent.Width - 60) / 2
                                    X: =30
                                    Y: =DataCardKey3_2.Y + DataCardKey3_2.Height + 5
                                    ZIndex: =2

                                HourValue2 As dropdown:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Text(Hour(Parent.Default),"00")
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Fill: =If(IsBlankOrError(Parent.Default), Color.LightPink, RGBA(245, 245, 245, 1))
                                    Font: =Font.'Segoe UI'
                                    Height: =DateValue2.Height
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]
                                    PaddingBottom: =5
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SelectionColor: =RGBA(50, 49, 48, 1)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    Tooltip: =Parent.DisplayName
                                    Width: |-
                                        =//DateValue2.Width / 2 - 10
                                        70
                                    X: |-
                                        =//DateValue2.X + DateValue2.Width + 10
                                        30
                                    Y: =DateValue2.Y
                                    ZIndex: =3

                                Separator2 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Bold
                                    Height: =HourValue2.Height
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: |-
                                        =":"
                                    Width: =10
                                    Wrap: =false
                                    X: =HourValue2.X + HourValue2.Width
                                    Y: =HourValue2.Y
                                    ZIndex: =4

                                MinuteValue2 As dropdown:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Text(Minute(Parent.Default),"00")
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Fill: =If(IsBlankOrError(Parent.Default), Color.LightPink, RGBA(245, 245, 245, 1))
                                    Font: =Font.'Segoe UI'
                                    Height: =HourValue2.Height
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"]
                                    PaddingBottom: =5
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SelectionColor: =RGBA(50, 49, 48, 1)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    Tooltip: =Parent.DisplayName
                                    Width: =HourValue2.Width
                                    X: =HourValue2.X + HourValue2.Width + Separator2.Width
                                    Y: =HourValue2.Y
                                    ZIndex: =5

                                ErrorMessage3_1 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =HourValue2.Y + HourValue2.Height
                                    ZIndex: =6

                                StarVisible3_1 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey3_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey3_2.Y
                                    ZIndex: =7

                            break_time_DataCard1 As typedDataCard.numberEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="break_time"
                                Default: |
                                    =//ThisItem.break_time
                                    If(
                                        // NewModeかつ学内の場合はデフォルト休憩時間に設定する
                                        WorkTimeForm1.Mode = FormMode.New  && DataCardValue1_2.Selected.Value = "学内",
                                        With(
                                            {
                                                break_time: LookUp(user_db,user_id = Calendar_UserPicker1.Selected.user_id).default_break_time
                                            },
                                                If(IsBlankOrError(break_time), 60, break_time)
                                        ),
                                        // 学内以外の場合は0分
                                        DataCardValue1_2.Selected.Value <> "学内",
                                        0,
                                        ThisItem.break_time
                                    )
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"break_time")
                                    "休憩時間 (分)"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =true
                                Update: =Value(DataCardValue2_2.Text)
                                Visible: =If(Not(DataCardValue1_2.Selected.Value in ["学内","在宅"]),false,true)
                                Width: =258
                                X: =0
                                Y: =2
                                ZIndex: =1

                                DataCardKey6_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue2_2 As text:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    Format: =TextFormat.Number
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey6_2.Y + DataCardKey6_2.Height + 5
                                    ZIndex: =2

                                ErrorMessage6_3 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue2_2.Y + DataCardValue2_2.Height
                                    ZIndex: =3

                                StarVisible6_3 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey6_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey6_2.Y
                                    ZIndex: =4

                            is_holiday_work_DataCard3 As typedDataCard.toggleEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="is_holiday_work"
                                Default: |-
                                    =//ThisItem.is_holiday_work
                                    // Form1がNewModeの場合は、8:00に設定
                                    If(WorkTimeForm1.Mode = 1,
                                        // 選択した日に出勤していて、休日出勤の場合「！」を表示
                                        If(IsBlankOrError(LookUp([@public_holiday_db], date = DateValue1.SelectedDate)),
                                            // public_holiday_dbの指定なし→土日判定
                                            If(Weekday(DateValue1.SelectedDate) = 1 || Weekday(DateValue1.SelectedDate) = 7,
                                                true,// 休日出勤
                                                false
                                            ),
                                            If(LookUp([@public_holiday_db], date = DateValue1.SelectedDate).is_holiday,
                                                true,// 休日出勤
                                                false
                                            )
                                        ),
                                        ThisItem.is_holiday_work
                                    )
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"is_holiday_work")
                                    "休日出勤"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =false
                                Update: =DataCardValue16.Value
                                Width: =258
                                X: =1
                                Y: =2
                                ZIndex: =1

                                DataCardKey16 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue16 As toggleSwitch:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    BorderStyle: =BorderStyle.None
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisplayMode: |-
                                        =If(
                                            First(Filter([@permission_db], permission_type = First(Filter([@user_db], mail_address = User().Email)).permission_type)).admin,
                                            Parent.DisplayMode,
                                            DisplayMode.Disabled // 管理者以外は無効化
                                        )
                                    FalseFill: =RGBA(96, 94, 92, 1)
                                    FalseHoverFill: =RGBA(50, 49, 48, 1)
                                    FalseText: ="無効"
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    HoverBorderColor: =RGBA(0, 0, 0, 0)
                                    PressedBorderColor: =RGBA(0, 0, 0, 0)
                                    Tooltip: =Parent.DisplayName
                                    TrueFill: =RGBA(0, 120, 212, 1)
                                    TrueHoverFill: =RGBA(16, 110, 190, 1)
                                    TrueText: ="有効"
                                    Width: =120
                                    X: =30
                                    Y: =DataCardKey16.Y + DataCardKey16.Height + 5
                                    ZIndex: =2

                                ErrorMessage16_1 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue16.Y + DataCardValue16.Height
                                    ZIndex: =3

                                StarVisible16_1 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey16.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey16.Y
                                    ZIndex: =4

                            Subject_DataCard1 As typedDataCard.textualEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="Subject"
                                Default: =ThisItem.Subject
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: |-
                                    =//DataSourceInfo([@work_db],DataSourceInfo.DisplayName,"Subject")
                                    "メモ"
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =Parent.Height - Start_DataCard1.Height - type_DataCard1_2.Height
                                MaxLength: =DataSourceInfo([@work_db], DataSourceInfo.MaxLength, Subject)
                                Required: =false
                                Update: =DataCardValue3_2.Text
                                Width: =258
                                X: =0
                                Y: =3
                                ZIndex: =1

                                DataCardKey7_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue3_2 As text:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: =Parent.Default
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    Height: =70
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    MaxLength: =Parent.MaxLength
                                    Mode: =TextMode.MultiLine
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey7_2.Y + DataCardKey7_2.Height + 5
                                    ZIndex: =2

                                ErrorMessage7_3 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue3_2.Y + DataCardValue3_2.Height
                                    ZIndex: =3

                                StarVisible7_3 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey7_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey7_2.Y
                                    ZIndex: =4

                            faculty_DataCard2 As typedDataCard.comboBoxEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="faculty"
                                Default: |-
                                    =//ThisItem.faculty
                                    LookUp([@user_db], user_id = Calendar_UserPicker1.Selected.user_id).faculty
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: =DataSourceInfo([@work_db],DataSourceInfo.DisplayName,faculty)
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =true
                                Update: =DataCardValue5_2.Selected
                                Visible: =false
                                Width: =258
                                X: =1
                                Y: =3
                                ZIndex: =1

                                DataCardKey5_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue5_2 As combobox:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DefaultSelectedItems: =Parent.Default
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayFields: =["Value"]
                                    DisplayMode: =Parent.DisplayMode
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =Choices([@work_db].faculty)
                                    PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SearchFields: =["Value"]
                                    SearchItems: =Choices(work_db.faculty,DataCardValue5_2.SearchText)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    SelectMultiple: =false
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey5_2.Y + DataCardKey5_2.Height + 5
                                    ZIndex: =2

                                ErrorMessage5_2 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue5_2.Y + DataCardValue5_2.Height
                                    ZIndex: =3

                                StarVisible5_2 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey5_2.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey5_2.Y
                                    ZIndex: =4

                            user_id_DataCard2 As typedDataCard.numberEditCard:
                                BorderColor: =RGBA(245, 245, 245, 1)
                                BorderStyle: =BorderStyle.Solid
                                DataField: ="user_id"
                                Default: =ThisItem.user_id
                                DisplayMode: =Parent.DisplayMode
                                DisplayName: =DataSourceInfo([@work_db],DataSourceInfo.DisplayName,user_id)
                                Fill: =RGBA(0, 0, 0, 0)
                                Height: =50
                                Required: =true
                                Update: =Value(DataCardValue4_1.Text)
                                Visible: =false
                                Width: =258
                                X: =0
                                Y: =4
                                ZIndex: =1

                                DataCardKey4_1 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =34
                                    PaddingLeft: =0
                                    Text: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    Wrap: =false
                                    X: =30
                                    Y: =10
                                    ZIndex: =1

                                DataCardValue4_1 As text:
                                    BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                                    Color: =RGBA(50, 49, 48, 1)
                                    Default: |-
                                        =//Parent.Default
                                        Calendar_UserPicker1.Selected.user_id
                                    DelayOutput: =true
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    DisplayMode: =Parent.DisplayMode
                                    Font: =Font.'Segoe UI'
                                    Format: =TextFormat.Number
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    PaddingLeft: =5
                                    PressedBorderColor: =RGBA(0, 120, 212, 1)
                                    PressedColor: =RGBA(50, 49, 48, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Tooltip: =Parent.DisplayName
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardKey4_1.Y + DataCardKey4_1.Height + 5
                                    ZIndex: =2

                                ErrorMessage4_1 As label:
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(168, 0, 0, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(168, 0, 0, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =10
                                    Live: =Live.Assertive
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    Text: =Parent.Error
                                    Visible: =Parent.DisplayMode=DisplayMode.Edit
                                    Width: =Parent.Width - 60
                                    X: =30
                                    Y: =DataCardValue4_1.Y + DataCardValue4_1.Height
                                    ZIndex: =3

                                StarVisible4_1 As label:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =DataCardKey4_1.Height
                                    PaddingLeft: =0
                                    Text: ="*"
                                    Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                                    Width: =30
                                    Wrap: =false
                                    Y: =DataCardKey4_1.Y
                                    ZIndex: =4

                        SelectSituationText As label:
                            Align: =Align.Center
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            FillPortions: =1
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =WorkTimeForm1.Height
                            Size: =14
                            Text: ="出勤情報がありません"
                            Visible: =And(IsBlank(RecordsGallery1_2.Selected),!newMode)
                            Width: =Parent.Width
                            ZIndex: =5

            RightMenu As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.None
                Fill: =RGBA(255, 255, 255, 1)
                FillPortions: =7
                Height: =Parent.Height
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =LayoutDirection.Vertical
                LayoutGap: =10
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingBottom: =2
                PaddingLeft: =2
                PaddingRight: =2
                Visible: =If(Or(deleteMode, !dispMenu, And(Calendar_Screen1.Size = ScreenSize.Small, !newMode, !editMode, !itemSelected)), false, true)
                Width: =0
                ZIndex: =3

                RightMenuContainer As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =10
                    LayoutMinHeight: =140
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =10
                    PaddingRight: =10
                    ZIndex: =1

                    MenuTitleContainer As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =35
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =1

                        MenuTitleText As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(50, 49, 48, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            Fill: =RGBA(255, 255, 255, 1)
                            FillPortions: =3
                            FocusedBorderThickness: =4
                            Font: =Font.Lato
                            Height: =35
                            LayoutMinWidth: =300
                            PaddingBottom: =0
                            PaddingLeft: =10
                            PaddingRight: =0
                            PaddingTop: =10
                            Size: =18
                            Text: |-
                                =//"メニュー"
                                "今月の休日出勤"
                            Width: =Parent.Width
                            ZIndex: =1

                        MenuIcon2 As icon:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Color: =RGBA(0, 120, 212, 1)
                            DisabledBorderColor: =RGBA(245, 245, 245, 1)
                            DisabledColor: =RGBA(225, 223, 221, 1)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FocusedBorderThickness: =4
                            Height: =44
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(16, 110, 190, 1)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Icon: =Icon.Hamburger
                            OnSelect: |-
                                =If(dispMenu, UpdateContext({ dispMenu: false }), UpdateContext({ dispMenu: true }))
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedColor: =RGBA(16, 110, 190, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Visible: =false
                            Width: =44
                            ZIndex: =3

                        MenuButton1_1 As button:
                            AlignInContainer: =AlignInContainer.Center
                            BorderColor: =RGBA(0, 120, 212, 1)
                            BorderStyle: =BorderStyle.None
                            DisabledBorderColor: =RGBA(0, 120, 212, 1)
                            DisabledColor: =RGBA(161, 159, 157, 1)
                            DisabledFill: =RGBA(242, 242, 241, 0)
                            Fill: =RGBA(128, 128, 128, 1)
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =RGBA(0, 120, 212, 1)
                            HoverFill: =RGBA(113, 111, 110, 1)
                            OnSelect: |-
                                =If(dispMenu,   
                                    UpdateContext({ dispMenu: false }), 
                                    UpdateContext({ dispMenu: true ,
                                                    user_holiday_db:Filter([@holiday_db],
                                                                            user_id = Calendar_UserPicker1.Selected.user_id,
                                                                            start_date >= Date(YearDropdown1.Selected.Value,4,1),
                                                                            start_date < Date(YearDropdown1.Selected.Value + 1,4,1)
                                                                         )
                                                    }
                                                )
                                )
                            PressedBorderColor: =RGBA(0, 69, 120, 1)
                            PressedColor: =RGBA(255, 255, 255, 1)
                            PressedFill: =RGBA(113, 111, 110, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =13
                            Text: ="勤務状況"
                            Width: =150
                            ZIndex: =4

                    RecordsListSeparator1_3 As rectangle:
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        Fill: =RGBA(230, 230, 230, 1)
                        FocusedBorderThickness: =4
                        Height: =1
                        HoverFill: =RGBA(230, 230, 230, 1)
                        LayoutMinWidth: =200
                        PressedFill: =RGBA(230, 230, 230, 1)
                        ZIndex: =2

                    HolidayRange As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        LayoutWrap: =true
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        X: =40
                        Y: =40
                        ZIndex: =3

                        HolidayRangeTitle As groupContainer.manualLayoutContainer:
                            AlignInContainer: =AlignInContainer.SetByContainer
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            Height: =HolidayRangeGallery.TemplateHeight
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Width: =HolidayRange.Width
                            ZIndex: =1

                            HolidayRangeTransfarTitle As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: ="振替日"
                                Width: =129
                                X: =HolidayRangeStartTitle.X+HolidayRangeStartTitle.Width
                                Y: =HolidayRangeTitle.Height/2 - Self.Height/2
                                ZIndex: =1

                            HolidayRangeStartTitle As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: ="振替範囲  "
                                Width: =Parent.Width/2
                                X: =HolidayRangeWorkDayTtitle.Width
                                Y: =HolidayRangeTitle.Height/2 - Self.Height/2
                                ZIndex: =2

                            HolidayRangeWorkDayTtitle As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: ="休日出勤日"
                                Width: =Parent.Width/4
                                Y: =HolidayRangeTitle.Height/2 - Self.Height/2
                                ZIndex: =3

                        RecordsListSeparator1_9 As rectangle:
                            AlignInContainer: =AlignInContainer.Stretch
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            DisabledFill: =RGBA(230, 230, 230, 1)
                            Fill: =RGBA(230, 230, 230, 1)
                            FillPortions: =1
                            FocusedBorderThickness: =4
                            Height: =1
                            HoverFill: =RGBA(230, 230, 230, 1)
                            LayoutMinHeight: =1
                            PressedFill: =RGBA(230, 230, 230, 1)
                            ZIndex: =2

                        "HolidayRangeGallery As gallery.'BrowseLayout_Vertical_TwoTextVariant_ver5.0'":
                            '#CopilotOverlayLabel': ="フィルター済み"
                            AlignInContainer: =AlignInContainer.Start
                            BorderColor: =RGBA(245, 245, 245, 1)
                            DelayItemLoading: =true
                            FillPortions: =0
                            Height: =Parent.Height-HolidayRangeTitle.Height-RecordsListSeparator1_9.Height
                            Items: |
                                =/*
                                Sort(
                                    Filter(MyCalendarEvents,
                                        // 休日出勤のレコード
                                        is_holiday_work = true
                                    ),
                                    Start // 日付でソート
                                )
                                
                                //休日出勤の申請から
                                Sort(
                                    Filter(user_holiday,
                                        //休日出勤
                                        LookUp(RenameColumns([@apply_type_db],type_id ,type_id2),type_id = type_id2).major_type_id =2
                                    ),
                                    start_date
                                )
                                */
                                user_holiday_works
                            Layout: =Layout.Vertical
                            LayoutMinHeight: =287
                            LayoutMinWidth: =320
                            LoadingSpinner: =LoadingSpinner.Data
                            TemplatePadding: =0
                            TemplateSize: =50
                            Width: =HolidayRange.Width
                            ZIndex: =3

                            HolidayRangeTransfar As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                Fill: |-
                                    =If(DateDiff(_dateSelected, LookUp([@holiday_db], ID = ThisItem.id_substitute_holiday).start_date) = 0,
                                        ColorFade(TodayCircle.Fill, 0.85),
                                        Color.White
                                    )
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                Height: =23
                                OnSelect: =Select(Parent)
                                Text: |-
                                    =If(
                                        IsBlankOrError(ThisItem.id_substitute_holiday),
                                        "未振替", // idが空なら未振替
                                        $"{Text( // idが空でないなら該当の休暇レコードのstart_dateを取得
                                            LookUp(
                                                [@holiday_db],
                                                ID = ThisItem.id_substitute_holiday
                                                ).start_date,
                                                "yyyy/mm/dd", "ja-JP")}"
                                    )
                                Width: =100
                                X: =HolidayRangeEnd.X + HolidayRangeEnd.Width
                                Y: |
                                    =Parent.TemplateHeight / 2 - Self.Size
                                ZIndex: =1

                            HolidayRangeEnd As label:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                Font: =Font.'Segoe UI'
                                FontWeight: |-
                                    =//If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                                    FontWeight.Normal
                                Height: =Self.Size * 1.8
                                OnSelect: =Select(Parent)
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: =$"{Text(DateAdd(ThisItem.Start, 56), "yyyy/mm/dd", "ja-JP")}"
                                VerticalAlign: =VerticalAlign.Top
                                Width: =HolidayRange.Width/4
                                X: =HolidayRange.Width/4*2
                                Y: |
                                    =Parent.TemplateHeight / 2 - Self.Size
                                ZIndex: =2

                            HolidayRangeStart As label:
                                Align: =Align.Right
                                BorderColor: =RGBA(0, 0, 0, 1)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                Font: =Font.'Segoe UI'
                                FontWeight: |-
                                    =//If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                                    FontWeight.Normal
                                Height: =Self.Size * 1.8
                                OnSelect: =Select(Parent)
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: =$"{Text(DateAdd(ThisItem.Start, -28), "yyyy/mm/dd ~", "ja-JP")}"
                                VerticalAlign: =VerticalAlign.Top
                                Width: =HolidayRange.Width/4
                                X: =HolidayRange.Width/4
                                Y: |
                                    =Parent.TemplateHeight / 2 - Self.Size
                                ZIndex: =3

                            HolidayRangeWorkDay As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 1)
                                Color: =RGBA(50, 49, 48, 1)
                                DisabledColor: =RGBA(161, 159, 157, 1)
                                Fill: |-
                                    =If(DateDiff(_dateSelected, ThisItem.Start) = 0,
                                        ColorFade(TodayCircle.Fill, 0.85),
                                        Color.White
                                    )
                                Font: =Font.'Segoe UI'
                                FontWeight: |-
                                    =//If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                                    FontWeight.Normal
                                Height: =Self.Size * 1.8
                                OnSelect: =Select(Parent)
                                PaddingBottom: =0
                                PaddingLeft: =12
                                PaddingRight: =0
                                PaddingTop: =0
                                Text: =$"{Text(ThisItem.Start, "yyyy/mm/dd", "ja-JP")}"
                                VerticalAlign: =VerticalAlign.Top
                                Width: =HolidayRange.Width/4
                                Y: |
                                    =Parent.TemplateHeight / 2 - Self.Size
                                ZIndex: =4

                            Icon2 As icon.ChevronRight:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                Color: =RGBA(113, 111, 110, 1)
                                DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                DisabledColor: =RGBA(225, 223, 221, 1)
                                DisabledFill: =RGBA(0, 0, 0, 0)
                                FocusedBorderThickness: =4
                                Height: =29
                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                HoverColor: =RGBA(16, 110, 190, 1)
                                HoverFill: =RGBA(0, 0, 0, 0)
                                Icon: =Icon.ChevronRight
                                OnSelect: |
                                    =Navigate(Apply_Screen,ScreenTransition.None,{newMode:true,fromCalendar:true,Holiday_StartWorkDay:Date(Year(ThisItem.Start),Month(ThisItem.Start),Day(ThisItem.Start)),
                                    Holiday_EndWorkDay:Date(Year(ThisItem.Start),Month(ThisItem.Start),Day(ThisItem.Start)),userID:Calendar_UserPicker1.Selected.user_id});
                                    NewForm(ApplyScreenForm1); 
                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                PressedColor: =RGBA(16, 110, 190, 1)
                                PressedFill: =RGBA(0, 0, 0, 0)
                                Visible: =IsBlankOrError(ThisItem.id_substitute_holiday)
                                Width: =18
                                X: =HolidayRangeTransfar.X+HolidayRangeTransfar.Width
                                Y: =9
                                ZIndex: =5

            DeleteConfirmDialogContainer1_1 As groupContainer.verticalAutoLayoutContainer:
                FillPortions: =7
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Visible: =If(deleteMode, true, false)
                Width: =0
                ZIndex: =4

                ConfirmDeletionLabel1_1 As label:
                    Align: =Align.Center
                    AlignInContainer: =AlignInContainer.Stretch
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(50, 49, 48, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(161, 159, 157, 1)
                    FillPortions: =1
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    PaddingBottom: =20
                    Size: =18
                    Text: ="選択した勤怠情報を削除しますか？"
                    VerticalAlign: =VerticalAlign.Bottom
                    ZIndex: =25

                ConfirmDeleteButtonBarContainer1_1 As groupContainer.horizontalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    LayoutGap: =15
                    LayoutJustifyContent: =LayoutJustifyContent.Center
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    LayoutWrap: =true
                    ZIndex: =26

                    CancelDeleteButton1_1 As button:
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        DisabledFill: =RGBA(242, 242, 241, 0)
                        Fill: =RGBA(0, 120, 212, 1)
                        Font: =Font.'Segoe UI'
                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                        HoverFill: =RGBA(16, 110, 190, 1)
                        OnSelect: |-
                            =UpdateContext({ deleteMode: false
                            //, deleteCancelled: true//未使用変数
                             })
                        PressedBorderColor: =RGBA(0, 69, 120, 1)
                        PressedColor: =RGBA(255, 255, 255, 1)
                        PressedFill: =RGBA(16, 110, 190, 1)
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Text: ="キャンセル"
                        ZIndex: =27

                    ConfirmDeleteButton1_1 As button:
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        DisabledFill: =RGBA(242, 242, 241, 0)
                        Fill: =RGBA(168, 0, 0, 1)
                        Font: =Font.'Segoe UI'
                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                        HoverFill: =RGBA(151, 0, 0, 1)
                        OnSelect: |-
                            =//編集ロックがかかっているか判定
                            If(LookUp(monthly_db,
                                And(user_id = LookUp(user_db,mail_address = User().Email).user_id,//職員番号が等しい
                                    year_month_date >=Date(Year(_dateSelected),Month(_dateSelected),1),
                                    year_month_date < DateAdd(Date(Year(_dateSelected),Month(_dateSelected),1),1,TimeUnit.Months))).lock,
                                Notify("提出が締め切られました.編集機能がロックされています.",NotificationType.Error),
                            
                            /*
                            //削除するレコード分monthly_dbに変更を加える
                            UpdateContext({target_monthly_item:
                                First(
                                        Filter(monthly_db
                                        ,user_id = Calendar_UserPicker1.Selected.user_id
                                        ,year_month_date>=Date(Year(Start_DataCard1.Update),Month(Start_DataCard1.Update),1)
                                        , year_month_date < Date(Year(Start_DataCard1.Update), Month(Start_DataCard1.Update) + 1, 1)
                                        )
                                )
                            }
                            );
                            
                            UpdateContext({now_work_days:target_monthly_item.work_days});
                            UpdateContext({now_work_hours:target_monthly_item.work_hours});
                            
                            UpdateContext({delete_work_start:Start_DataCard1.Update});
                            UpdateContext({delete_work_end:End_DataCard1.Update}); 
                            UpdateContext({delete_work_hours:(DateDiff(delete_work_start,delete_work_end,TimeUnit.Minutes)-Value(DataCardValue2_2.Text))/60});
                            
                            //既に同日のレコードが存在する場合は，日数を減らさない．もし存在しない場合は日数を減らす
                            If(CountRows(Filter(MyCalendarEvents,DateValue(Text(Start)) = DateValue(Text(Start_DataCard1.Update))))>=2,
                                UpdateContext({new_work_days:now_work_days}),
                                UpdateContext({new_work_days:now_work_days-1})
                            );
                            UpdateContext({new_work_hours:now_work_hours-delete_work_hours});
                            
                            //monthly_dbの該当月のレコードを更新
                            Patch(monthly_db,target_monthly_item,{work_days:new_work_days});
                            Patch(monthly_db,target_monthly_item,{work_hours:new_work_hours});
                            
                            */
                            //選択しているレコードを消去する
                            Remove([@work_db], selectedRecord); 
                            If(IsEmpty(Errors([@work_db], selectedRecord)), 
                                    UpdateContext( { 
                                        //CurrentItem: First(RecordsGallery1_2.AllItems),//未使用変数
                                         itemSelected: false, editMode: false, newMode: false, deleteMode: false }
                                )
                            );
                            // カレンダーをリロード
                            // Refresh([@work_db]);
                            Select(Update2);
                            
                            )
                        PressedBorderColor: =RGBA(0, 69, 120, 1)
                        PressedColor: =RGBA(255, 255, 255, 1)
                        PressedFill: =RGBA(168, 0, 0, 1)
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Text: ="削除"
                        ZIndex: =28

            RegisterBusinessTripMenu As groupContainer.verticalAutoLayoutContainer:
                Fill: =RGBA(255, 255, 255, 1)
                FillPortions: =7
                Height: =100
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =LayoutDirection.Vertical
                LayoutGap: =10
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Visible: =RegisterBusinessTripMode
                ZIndex: =5

                RegisterTitleContainer As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    DropShadow: =DropShadow.None
                    Fill: =RGBA(255, 255, 255, 1)
                    FillPortions: =0
                    Height: =45
                    LayoutAlignItems: =LayoutAlignItems.Center
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutJustifyContent: =LayoutJustifyContent.Center
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    ZIndex: =1

                    TitleContainer As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        Height: =Parent.Height
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                        LayoutMinHeight: =30
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        ZIndex: =2

                        Label3 As label:
                            PaddingLeft: =15
                            Size: =18
                            Text: ="一括登録"
                            Width: =200
                            ZIndex: =1

                        MenuButton1_2 As button:
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =0
                            Fill: =RGBA(128, 128, 128, 1)
                            Height: =30
                            HoverBorderColor: =RGBA(0, 120, 212, 1)
                            HoverFill: =RGBA(113, 111, 110, 1)
                            OnSelect: |-
                                =If(RegisterBusinessTripMode,
                                    UpdateContext({RegisterBusinessTripMode:false});
                                    Reset(StartBussinessDatePicker);
                                    Reset(EndBussinessTripDatePicker);
                                    Reset(WorkTypeDropdown);
                                    Reset(SubjectEdit),
                                    
                                    UpdateContext({RegisterBusinessTripMode:true}))
                            PressedBorderColor: =RGBA(0, 69, 120, 1)
                            PressedColor: =RGBA(255, 255, 255, 1)
                            PressedFill: =RGBA(113, 111, 110, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =13
                            Text: ="勤務状況"
                            Width: =150
                            ZIndex: =2

                    RecordsListSeparator1_10 As rectangle:
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        Fill: =RGBA(230, 230, 230, 1)
                        FocusedBorderThickness: =4
                        Height: =1
                        HoverFill: =RGBA(230, 230, 230, 1)
                        LayoutMinWidth: =200
                        PressedFill: =RGBA(230, 230, 230, 1)
                        ZIndex: =3

                BussinessTripFormContainer As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    DropShadow: =DropShadow.None
                    Fill: =RGBA(255, 255, 255, 1)
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =10
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =5
                    PaddingLeft: =5
                    PaddingRight: =5
                    PaddingTop: =5
                    ZIndex: =3

                    FormTitleContainer As groupContainer.horizontalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =35
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =!submitMode
                        ZIndex: =1

                        FormTitle As label:
                            FillPortions: =1
                            PaddingLeft: =20
                            Size: =20
                            Text: =
                            Visible: =!submitMode
                            Width: =250
                            ZIndex: =1

                        RegisterCheckIcon As icon.Check:
                            Height: =44
                            Icon: =Icon.Check
                            OnSelect: |-
                                =UpdateContext({submitMode:true});
                                With({user_name:Calendar_UserPicker1.Selected.user_name,
                                      user_id:Calendar_UserPicker1.Selected.user_id,
                                      type:WorkTypeDropdown.SelectedText,
                                      start:StartBussinessDatePicker.SelectedDate,
                                      end:EndBussinessTripDatePicker.SelectedDate,
                                      subject:SubjectEdit.Text},
                                      
                                      //提出するレコードを定義
                                    UpdateContext({submitRecord:
                                        {User_Name:user_name,
                                        User_ID:user_id,
                                        Type:type,
                                        Start:start,
                                        End:end,
                                        Subject : subject
                                    }})   
                                )
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Visible: =!submitMode
                            Width: =44
                            ZIndex: =2

                        RegisterCansellIcon As icon.Cancel:
                            Height: =44
                            Icon: =Icon.Cancel
                            OnSelect: |-
                                =UpdateContext({RegisterBusinessTripMode:false});
                                Reset(StartBussinessDatePicker);
                                Reset(EndBussinessTripDatePicker);
                                Reset(WorkTypeDropdown);
                                Reset(SubjectEdit)
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            Visible: =!submitMode
                            Width: =44
                            ZIndex: =3

                    RecordsListSeparator1_7 As rectangle:
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        DisabledFill: =RGBA(230, 230, 230, 1)
                        Fill: =RGBA(230, 230, 230, 1)
                        FocusedBorderThickness: =4
                        Height: =1
                        HoverFill: =RGBA(230, 230, 230, 1)
                        LayoutMinWidth: =200
                        PressedFill: =RGBA(230, 230, 230, 1)
                        ZIndex: =2

                    FormItemConteiner As groupContainer.verticalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        LayoutOverflowY: =LayoutOverflow.Scroll
                        PaddingBottom: =20
                        PaddingLeft: =20
                        PaddingRight: =20
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Visible: =!submitMode
                        ZIndex: =3

                        Name As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            Height: =70
                            LayoutAlignItems: =LayoutAlignItems.Center
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =1

                            SubmitNameTitle As label:
                                FillPortions: =1
                                Size: =14
                                Text: =$"氏名　{Calendar_UserPicker1.Selected.user_name}"
                                ZIndex: =1

                            SubmitUserID As label:
                                FillPortions: =1
                                Size: =14
                                Text: =$"職員番号　{Calendar_UserPicker1.Selected.user_id}"
                                ZIndex: =2

                        WorkType As groupContainer.horizontalAutoLayoutContainer:
                            AlignInContainer: =AlignInContainer.Start
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            Height: =70
                            LayoutAlignItems: =LayoutAlignItems.Center
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =2

                            WorkTypeTitle As label:
                                LayoutMinWidth: =50
                                Size: =14
                                Text: ="勤務場所　"
                                ZIndex: =1

                            WorkTypeDropdown As dropdown:
                                BorderThickness: =0
                                Default: ="出張"
                                Fill: =RGBA(245, 245, 245, 1)
                                Items: |
                                    =Filter(Choices([@work_db].type),Not(Value in ["学内","在宅","職免"]))
                                Size: =14
                                ZIndex: =2

                        StartBussinessTrip As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            Height: =70
                            LayoutAlignItems: =LayoutAlignItems.Center
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =3

                            StartBussinessTripTitle As label:
                                Size: =14
                                Text: =$"{WorkTypeDropdown.Selected.Value}の開始日　"
                                ZIndex: =1

                            StartBussinessDatePicker As datepicker:
                                BorderThickness: =0
                                Fill: =RGBA(245, 245, 245, 1)
                                PaddingTop: =5
                                StartOfWeek: =StartOfWeek.Monday
                                ZIndex: =2

                        EndBussinesTrip As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            Height: =70
                            LayoutAlignItems: =LayoutAlignItems.Center
                            LayoutMinHeight: =70
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =4

                            EndBussinessTripTitle As label:
                                Size: =14
                                Text: =$"{WorkTypeDropdown.Selected.Value}の終了日" 
                                ZIndex: =1

                            EndBussinessTripDatePicker As datepicker:
                                BorderThickness: =0
                                Fill: =RGBA(245, 245, 245, 1)
                                PaddingTop: =5
                                StartOfWeek: =StartOfWeek.Monday
                                ZIndex: =2

                        SubjectContainer As groupContainer.verticalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            FillPortions: =0
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =5

                            SubjectExplaine As label:
                                Size: =14
                                Text: |
                                    ="メモ"
                                ZIndex: =1

                            SubjectEdit As text:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(245, 245, 245, 1)
                                Default: =""
                                Height: |
                                    =100
                                Mode: =TextMode.MultiLine
                                RadiusBottomLeft: =0
                                RadiusBottomRight: =0
                                RadiusTopLeft: =0
                                RadiusTopRight: =0
                                Size: =14
                                Width: |
                                    =Parent.Width-30
                                ZIndex: =2

                    SubmitContainer As groupContainer.verticalAutoLayoutContainer:
                        ContentLanguage: |-
                            =$"氏名:{submitRecord.User_Name}"
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        Visible: =submitMode
                        ZIndex: =4

                        SubmitDetailContainer As groupContainer.manualLayoutContainer:
                            AlignInContainer: =AlignInContainer.Center
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            ZIndex: =1

                            SubmitDetail As label:
                                Height: =Parent.Height
                                Size: =18
                                Text: |-
                                    =$"氏名　:　{submitRecord.User_Name} 
                                    職員番号　:　{submitRecord.User_ID}
                                    勤務場所　:　{submitRecord.Type.Value}
                                    {submitRecord.Type.Value}の開始日　:　{Text(submitRecord.Start,"yyyy年 m月 d日","ja-JP")}
                                    {submitRecord.Type.Value}の終了日　:　{Text(submitRecord.End,"yyyy年 m月 d日","ja-JP")}
                                    メモ　: {If(IsBlank(submitRecord.Subject),"無し",submitRecord.Subject)}"
                                Width: =Parent.Width
                                ZIndex: =1

                        SubmitExplane As label:
                            Align: =Align.Center
                            Text: |-
                                =$"以上の内容で{submitRecord.Type.Value}登録を行いますか。
                                {If(submitRecord.Type.Value = "学外長期研修","※休日等は勤務情報を入力しません。","")}"
                            Width: =Parent.Width
                            ZIndex: =2

                        ButtonContainer As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.None
                            LayoutGap: =30
                            LayoutJustifyContent: =LayoutJustifyContent.Center
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingLeft: =50
                            PaddingRight: =50
                            PaddingTop: =50
                            ZIndex: =3

                            Button2 As button:
                                OnSelect: |-
                                    =UpdateContext({submitMode:false})
                                RadiusBottomLeft: =0
                                RadiusBottomRight: =0
                                RadiusTopLeft: =0
                                RadiusTopRight: =0
                                Text: ="キャンセル"
                                ZIndex: =1

                            Button3 As button:
                                OnSelect: |
                                    =With({
                                        User_ID : submitRecord.User_ID,
                                        start_work:submitRecord.Start,
                                        end_work:submitRecord.End,
                                        submit_type:submitRecord.Type,
                                        subject : submitRecord.Subject,
                                        //大学の休みの日
                                        holiday_univ:Filter([@public_holiday_db],is_holiday),
                                        user_faculty:LookUp([@user_db],user_id = submitRecord.User_ID).faculty,
                                        working_days:DateDiff(submitRecord.Start,submitRecord.End,TimeUnit.Days),
                                        apply_Year:If(Month(submitRecord.Start)<4,Year(submitRecord.Start)-1,Year(submitRecord.Start)),
                                        Today_Year:If(Month(Today())<4,Year(Today())-1,Year(Today())),
                                        user_holiday_weekday:ForAll(LookUp([@user_db], user_id = submitRecord.User_ID).holiday_weekday, Value(ThisRecord.Value)),
                                        //申請する人のみの休暇願い
                                        user_holiday_apply:Filter(RenameColumns([@holiday_db],type_id,TypeID),
                                                            user_id = submitRecord.User_ID,
                                                            LookUp([@apply_type_db],type_id = TypeID).major_type_id = 1,
                                                            !is_reject,
                                                            start_date >= Date(If(Month(Today())<4,Year(Today())-1,Year(Today())),4,1),
                                                            end_date <= Date(If(Month(Today())<4,Year(Today()),Year(Today())+1),3,31)
                                    
                                                            
                                                            
                                        )
                                        
                                        },
                                        //開始日>終了日だとエラー
                                        If(start_work > end_work,
                                            Notify($"{submit_type.Value}の開始日は終了日より前に設定してください",NotificationType.Error);
                                            UpdateContext({submitMode:false}),
                                        //編集ロックがかかっているかどうか
                                            LookUp([@monthly_db],
                                                And(user_id = User_ID,
                                                    year_month_date >= Date(Year(submitRecord.Start),Month(submitRecord.Start),1),
                                                    year_month_date < DateAdd(Date(Year(submitRecord.Start),Month(submitRecord.Start),1),1,TimeUnit.Months)
                                                    )).lock,
                                            Notify("提出が締め切られました。編集機能がロックされています。",NotificationType.Error);
                                            UpdateContext({submitMode:false}),
                                            !(apply_Year = Today_Year),
                                            Notify("今年度のもののみ申請してください。",NotificationType.Error);
                                            UpdateContext({submitMode:false}),
                                            ForAll(
                                                Sequence(working_days+1) As add_days,
                                                With({selected_day:DateAdd(start_work,add_days.Value-1,TimeUnit.Days)
                                                
                                                },
                                                    If(And(
                                                        Not(Weekday(selected_day) in user_holiday_weekday),//個人の休日に含まれない
                                                        //IsBlank(LookUp([@public_holiday_db],And(selected_day = date,is_holiday ))),//大学の休日でない
                                                        IsBlank(LookUp(holiday_univ,selected_day = date)),
                                                        IsEmpty(Filter(user_holiday_apply,start_date<=selected_day,selected_day <= end_date))//休暇願いがでていない
                                                        ),
                                                    Patch([@work_db],
                                                        {user_id:User_ID,
                                                        Start:selected_day,
                                                        End:selected_day,
                                                        faculty:user_faculty,
                                                        type:submit_type,
                                                        break_time:0,
                                                        Subject:subject,
                                                        reg_type:RegTypeDoropDown.SelectedText,
                                                        is_holiday_work : Or(
                                                            Weekday(DateAdd(start_work,add_days.Value-1,TimeUnit.Days)) = 1,
                                                            Weekday(DateAdd(start_work,add_days.Value-1,TimeUnit.Days)) = 7,
                                                            !IsBlank(LookUp(holiday_univ,selected_day = date))
                                                            )
                                                        }
                                                    );
                                                    ,
                                                    submit_type.Value = "出張",
                                                    Notify($"{selected_day}は休日なので出張レコードを作成していません",NotificationType.Warning);
                                                );
                                            ));
                                            Notify("登録完了しました。",NotificationType.Success);
                                            UpdateContext({submitMode:false,RegisterBusinessTripMode:false});
                                            Reset(StartBussinessDatePicker);
                                            Reset(EndBussinessTripDatePicker);
                                            Reset(WorkTypeDropdown);
                                            Reset(SubjectEdit);
                                            Select(Update2)
                                        );
                                            
                                    
                                    
                                            
                                    )
                                RadiusBottomLeft: =0
                                RadiusBottomRight: =0
                                RadiusTopLeft: =0
                                RadiusTopRight: =0
                                Text: ="登録"
                                ZIndex: =2

                        RegTypeDoropDown As dropdown:
                            Default: ="管理者"
                            Items: =Choices([@work_db].reg_type)
                            Visible: =false
                            ZIndex: =4

    Menu_bg_3 As rectangle:
        BorderColor: =RGBA(131, 24, 75, 1)
        Fill: =RGBA(0, 0, 0, 0.25)
        Height: =Parent.Height
        OnSelect: =Set(disp_menu, Not(disp_menu));
        Visible: =disp_menu
        Width: =App.Width
        ZIndex: =2

    Menu_3 As Menu:
        Approval: =Approval_Screen1
        CalcHoliday: =CalcHoliday_Screen1
        Calendar: =Calendar_Screen1
        Holiday: =Apply_Screen
        Home: =Home_Screen
        is_admin: =LookUp([@permission_db], permission_type = LookUp([@user_db], mail_address = User().Email).permission_type).admin
        Setting: =
        User: =User_Screen1
        Visible: =disp_menu
        ZIndex: =3

    Update2 As button:
        BorderColor: =RGBA(0, 0, 0, 0)
        BorderStyle: =BorderStyle.None
        DisabledBorderColor: =RGBA(0, 0, 0, 0)
        DisabledColor: =RGBA(161, 159, 157, 1)
        DisabledFill: =RGBA(242, 242, 241, 0)
        Fill: =RGBA(0, 120, 212, 1)
        Font: =Font.'Segoe UI'
        Height: =0
        HoverBorderColor: =RGBA(0, 0, 0, 0)
        HoverFill: =RGBA(16, 110, 190, 1)
        OnSelect: |-
            =//0.今年度の休日出勤しているものを格納
            UpdateContext(
                {
                    user_holiday_works:Filter(
                        [@work_db],
                        user_id = Calendar_UserPicker1.Selected.user_id,
                        Start >Date(If(Value(MonthDropdown1.Selected.Value) < 4 , YearDropdown1.Selected.Value-1, YearDropdown1.Selected.Value),3,31),
                        Start < Date(If(Value(MonthDropdown1.Selected.Value) < 4 , YearDropdown1.Selected.Value, YearDropdown1.Selected.Value+1),3,31),
                        is_holiday_work
                        )}
            );
            
            // 1. 選択月の申請レコードをcurrent_month_holiday_dbに格納
            //
            
            UpdateContext(
                {
                    current_month_holiday_db: Filter(
                        [@holiday_db],
                        user_id = Calendar_UserPicker1.Selected.user_id,
                        start_date >= _firstDayOfMonth,
                        end_date < _lastDayOfMonth
                    )
                }
            );
            // 2. 選択月の出勤レコードをMyCalendarEventsに格納
            With(
                {
                    // work_dbから取り出す
                    current_month_work_db: Filter(
                        [@work_db],
                        user_id = Calendar_UserPicker1.Selected.user_id,
                        (Start >= _firstDayOfMonth && Start < _lastDayOfMonth) || (End >= _firstDayOfMonth && End < _lastDayOfMonth)
                    )
                },
                // 取り出したwork_dbに各種列を追加する
                ClearCollect(
                    MyCalendarEvents,
                    AddColumns(
                        current_month_work_db,
                        // 勤務時間
                        work_time,
                        DateDiff(
                            DateAdd(
                                Start,
                                break_time,
                                TimeUnit.Minutes
                            ),
                            End,
                            TimeUnit.Minutes
                        ),
                        // 勤務日の日付
                        date,
                        DateValue(
                            Text(
                                Start,
                                "yyyy/mm/dd"
                            )
                        ),
                        // 勤務時間抜け
                        error_work_time,
                        IsBlank(Start) || IsBlank(End),
                        // 勤務時間重複
                        overlapping_exists,
                        !IsEmpty(
                            Filter(
                                current_month_work_db As record2,
                                ThisRecord.ID <> record2.ID && ((ThisRecord.Start <= record2.End && ThisRecord.End >= record2.Start) || (record2.Start <= ThisRecord.End && record2.End >= ThisRecord.Start))
                            )
                        ),
                        // 休暇申請重複
                        duplicate_application,
                        !IsEmpty(
                            Filter(
                                current_month_holiday_db,
                                LookUp(RenameColumns([@apply_type_db], type_id, type_id2), type_id2 = type_id).major_type.Value = "休暇願い",
                                start_date <= DateValue(
                                    Text(
                                        Start,
                                        "yyyy/mm/dd"
                                    )
                                ),
                                end_date >= DateValue(
                                    Text(
                                        Start,
                                        "yyyy/mm/dd"
                                    )
                                ),
                                !(is_check = false && !IsBlank(check_id))//却下ではない
                            )
                        ),
                        // 欠勤(データなし)
                        is_absence,
                        false
                    )
                )
            );
            // 3. MyCalendarEvents(work_db)から月別計算(monthly_db)の各列を計算
            With(
                {
                    monthly_db_record: LookUp(
                        [@monthly_db],
                        user_id = Calendar_UserPicker1.Selected.user_id && year_month_date = _firstDayOfMonth
                    ),
                    calc_work_time: Sum(
                        MyCalendarEvents,
                        work_time
                    ),
                    calc_work_days: CountRows(
                        Distinct(
                            MyCalendarEvents,
                            date
                        )
                    ),
                    calc_confirmed_work_days: CountRows(
                        Distinct(
                            Filter(
                                MyCalendarEvents,
                                reg_type.Value = "カードリーダー" || reg_type.Value = "カードリーダー編集"
                            ),
                            date
                        )
                    ),
                    // current_year:Year(_firstDayOfMonth),
                    // current_month:Month(_firstDayOfMonth),
                    // date_range_end:If(_firstDayOfMonth>Today(),_firstDayOfMonth,_lastDayOfMonth<Today(),_lastDayOfMonth,Today()),
                    // PublicHolidays:[@public_holiday_db],
                    // エラー日数の計算
                    calc_error_days: Sum(
                        CountRows(
                            Filter(
                                MyCalendarEvents,
                                error_work_time || work_time < 0 || duplicate_application
                            )
                        ),
                        CountRows(
                            Distinct(
                                Filter(
                                    MyCalendarEvents,
                                    overlapping_exists
                                ),
                                date
                            )
                        )
                    ),
                    // 営業日の計算
                    calc_business_days: CountIf(
                        ForAll(
                            Sequence(
                                If(
                                    Month(_lastDayOfMonth) = Month(Today()) && _lastDayOfMonth > Today(),
                                    Today(),
                                    _lastDayOfMonth
                                ) - _firstDayOfMonth
                            ),
                            _firstDayOfMonth + Value - 1
                        ),
                        And(
                            Weekday(Value) in [
                                2,
                                3,
                                4,
                                5,
                                6
                            ],
                            Not(
                                Value in Filter(
                                    [@public_holiday_db],
                                    is_holiday = true
                                ).date
                            )
                        )
                    )
                },
                If(
                    !IsBlankOrError(monthly_db_record) && !monthly_db_record.lock,// エラーではないかつ月末ロックがされていない
                    //Notify("データベース整合中...", NotificationType.Information, 1);
                    /*
                            //欠勤日数の取得
                            UpdateContext({
                            absence_work_day:CountRows(Filter(Sequence(DateDiff(_firstDayOfMonth,date_range_end)) As Day,
            
                                    IsBlank(LookUp([@MyCalendarEvents],date =Date(current_year,current_month,Day.Value))),
                                    IsBlank(LookUp(current_month_holiday_db,And(user_id = Calendar_UserPicker1.Selected.user_id,start_date<=Date(current_year,current_month,Day.Value),end_date >=Date(current_year,current_month,Day.Value)))),
                                    !Or(Weekday(Date(current_year,current_month,Day.Value)) = 7,Weekday(Date(current_year,current_month,Day.Value)) = 1 , !IsBlank(LookUp(PublicHolidays,date = Date(current_year,current_month,Day.Value))))
                            ))
                        });
                        */
                    Patch(
                        [@monthly_db],
                        monthly_db_record,
                        {
                            work_time: calc_work_time,
                            work_days: calc_work_days,
                            confirmed_work_days: calc_confirmed_work_days,
                            // absence_days: absence_work_day,
                            absence_days: calc_business_days - calc_work_days,
                            error_days: calc_error_days
                        }
                    )/*;
                    Notify(
                        $"{calc_business_days} {calc_work_days}",
                        NotificationType.Information,
                        10
                    )*/,
                    Notify(
                        "月末ロックされています",
                        NotificationType.Information,
                        2
                    );
                )
            );
            
            
            // Notify("読み込み完了！", NotificationType.Success, 1);
            
            /*
            // 4. MyCalendarEvents(work_db)の欠損日を追加する
            ForAll(
                Sequence(
                    _lastDayOfMonth - _firstDayOfMonth
                ),
                With(
                    {
                        current_date: DateAdd(_firstDayOfMonth, Value - 1, TimeUnit.Days)
                    },
                    If(IsBlank(LookUp(MyCalendarEvents, DateValue(date) = current_date)),
                        Collect(
                            MyCalendarEvents,
                            {date: current_date, is_absence:true}
                        )
                    )
                )
            )
            */
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        PressedBorderColor: =RGBA(0, 69, 120, 1)
        PressedColor: =RGBA(255, 255, 255, 1)
        PressedFill: =RGBA(16, 110, 190, 1)
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Text: =""
        Visible: =false
        Width: =0
        X: =20
        Y: =20
        ZIndex: =4

    CalcAbsenceButton As button:
        OnSelect: |-
            =With({
                current_year:Year(_firstDayOfMonth),
                current_month:Month(_firstDayOfMonth),
                date_range_end:If(_firstDayOfMonth>Today(),_firstDayOfMonth,_lastDayOfMonth<Today(),_lastDayOfMonth,Today()),
                MyHolidayEvent:Filter([@holiday_db],user_id = Calendar_UserPicker1.Selected.user_id,start_date>= _firstDayOfMonth,end_date <=_lastDayOfMonth),
                PublicHolidays:[@public_holiday_db]
                },
                UpdateContext({
                    absence_work_day:CountRows(Filter(Sequence(DateDiff(_firstDayOfMonth,date_range_end)) As Day,
            
                            IsBlank(LookUp([@MyCalendarEvents],date =Date(current_year,current_month,Day.Value))),
                            IsBlank(LookUp(MyHolidayEvent,And(user_id = Calendar_UserPicker1.Selected.user_id,start_date<=Date(current_year,current_month,Day.Value),end_date >=Date(current_year,current_month,Day.Value)))),
                            !Or(Weekday(Date(current_year,current_month,Day.Value)) = 7,Weekday(Date(current_year,current_month,Day.Value)) = 1 , !IsBlank(LookUp(PublicHolidays,date = Date(current_year,current_month,Day.Value))))
                    ))
                });
            )
        Text: ="ボタン"
        Visible: =false
        X: =252
        Y: =84
        ZIndex: =5

